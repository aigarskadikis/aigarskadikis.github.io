<html><head><style type='text/css'>
.tabs .tab,.tabs input[type=radio]:checked+label{background:#fff}.tabs,.tabs label,body{display:flex}.tabs .tab,.tabs input[type=radio]{display:none}#searchResultDlg,#searchResultDlgContent{overflow:auto;overscroll-behavior:contain}#closeIcon,.tabs input[type=radio]:checked+label+.tab{display:block}.tabs{flex-wrap:wrap;width:100%}.tabs label{order:1;justify-content:center;align-items:center;padding:.1rem .5rem;margin:0;cursor:pointer}.tabs .tab{order:9;flex-grow:1;width:100%;height:1000rem;padding:.4rem}body{background:#dcdcdc;min-height:100vh;box-sizing:border-box;font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen,Ubuntu,Fira Sans,Droid Sans,Helvetica Neue,sans-serif;font-weight:300;line-height:1.5;font-size:100%}pre{padding:.2em;margin:0 0 1em;background-color:#FFF7F0;border-radius:3px;border:1px solid #CCCCCC}#searchInputArea{display:flex;position:absolute;right:50px;top:5px}#searchInput{margin-left:20px;border:0}#searchInput:focus{outline:0}#searchResultDlg{display:none;flex-direction:column;position:fixed;top:50px;left:100px;right:100px;bottom:50px;padding:10px;background-color:#dcdcdc}#searchResultDlgContent{display:grid;flex-direction:column;height:100%}#closeIcon{color:#778899;font-size:55px;position:fixed;top:20px;right:50px;cursor:pointer}.resultBlock{width:100%;border-bottom:1px solid #000}.resultBlock .tabName{font-size:1.2em;font-weight:700}
</style></head><body onLoad='initDataArray()'><div class='tabs'>
<input type="radio" name="tabs" id="30"><label for="30">30.sql</label><div class="tab">
Show items by proxy<pre><code>SELECT COUNT(*),proxy.host AS proxy,items.type 
FROM items 
JOIN hosts ON (items.hostid=hosts.hostid) 
JOIN hosts proxy ON (hosts.proxy_hostid=proxy.hostid) 
WHERE hosts.status = 0 
AND items.status = 0 
AND proxy.status IN (5,6) 
GROUP BY 2,3 
ORDER BY 2,3;</code></pre>
Devices and it's status<pre><code>SELECT proxy.host AS proxy, hosts.host, interface.ip, interface.dns, interface.useip, 
CASE hosts.available 
WHEN 0 THEN 'unknown'  
WHEN 1 THEN 'available' 
WHEN 2 THEN 'down' 
END AS "status", 
CASE interface.type 
WHEN 1 THEN 'ZBX' 
WHEN 2 THEN 'SNMP' 
WHEN 3 THEN 'IPMI' 
WHEN 4 THEN 'JMX' 
END AS "type", 
hosts.error 
FROM hosts 
JOIN interface ON interface.hostid=hosts.hostid 
LEFT JOIN hosts proxy ON hosts.proxy_hostid=proxy.hostid 
WHERE hosts.status=0 
AND interface.main=1;</code></pre>
Items in use<pre><code>SELECT CASE items.type  
WHEN 0 THEN 'Zabbix agent'  
WHEN 1 THEN 'SNMPv1 agent'  
WHEN 2 THEN 'Zabbix trapper'  
WHEN 3 THEN 'Simple check'  
WHEN 4 THEN 'SNMPv2 agent'  
WHEN 5 THEN 'Zabbix internal'  
WHEN 6 THEN 'SNMPv3 agent'  
WHEN 7 THEN 'Zabbix agent (active) check'  
WHEN 8 THEN 'Aggregate'  
WHEN 9 THEN 'HTTP test (web monitoring scenario step)'  
WHEN 10 THEN 'External check'  
WHEN 11 THEN 'Database monitor'  
WHEN 12 THEN 'IPMI agent'  
WHEN 13 THEN 'SSH agent'  
WHEN 14 THEN 'TELNET agent'  
WHEN 15 THEN 'Calculated'  
WHEN 16 THEN 'JMX agent'  
WHEN 17 THEN 'SNMP trap'  
WHEN 18 THEN 'Dependent item'  
WHEN 19 THEN 'HTTP agent'  
WHEN 20 THEN 'SNMP agent'  
WHEN 21 THEN 'Script item'  
END AS type,COUNT(*)  
FROM items  
JOIN hosts ON (hosts.hostid=items.hostid)  
WHERE hosts.status=0  
AND items.status=0  
GROUP BY items.type  
ORDER BY COUNT(*) DESC;</code></pre>
All active data collector items on enabled hosts<pre><code>SELECT 
hosts.host, 
items.name, 
items.type, 
items.key_, 
items.delay 
FROM items 
JOIN hosts ON (hosts.hostid=items.hostid) 
WHERE hosts.status=0 
AND items.status=0 
ORDER BY 1,2,3,4,5;</code></pre>
<p>Download this section: <a href="src/30.sql">https://aigarskadikis.github.io/src/30.sql</a><br />
Fancy syntax highlighter? Read same page on GitHub: <a href="https://github.com/aigarskadikis/aigarskadikis.github.io/blob/main/src/30.sql" target="_blank">https://github.com/aigarskadikis/aigarskadikis.github.io/blob/main/src/30.sql</a></p>
</div>
<input type="radio" name="tabs" id="32"><label for="32">32.sql</label><div class="tab">
Show items by proxy<pre><code>SELECT COUNT(*),proxy.host AS proxy,items.type 
FROM items 
JOIN hosts ON (items.hostid=hosts.hostid) 
JOIN hosts proxy ON (hosts.proxy_hostid=proxy.hostid) 
WHERE hosts.status = 0 
AND items.status = 0 
AND proxy.status IN (5,6) 
GROUP BY 2,3 
ORDER BY 2,3;</code></pre>
Devices and it's status<pre><code>SELECT proxy.host AS proxy, hosts.host, interface.ip, interface.dns, interface.useip, 
CASE hosts.available 
WHEN 0 THEN 'unknown'  
WHEN 1 THEN 'available' 
WHEN 2 THEN 'down' 
END AS "status", 
CASE interface.type 
WHEN 1 THEN 'ZBX' 
WHEN 2 THEN 'SNMP' 
WHEN 3 THEN 'IPMI' 
WHEN 4 THEN 'JMX' 
END AS "type", 
hosts.error 
FROM hosts 
JOIN interface ON interface.hostid=hosts.hostid 
LEFT JOIN hosts proxy ON hosts.proxy_hostid=proxy.hostid 
WHERE hosts.status=0 
AND interface.main=1;</code></pre>
Items in use<pre><code>SELECT CASE items.type  
WHEN 0 THEN 'Zabbix agent'  
WHEN 1 THEN 'SNMPv1 agent'  
WHEN 2 THEN 'Zabbix trapper'  
WHEN 3 THEN 'Simple check'  
WHEN 4 THEN 'SNMPv2 agent'  
WHEN 5 THEN 'Zabbix internal'  
WHEN 6 THEN 'SNMPv3 agent'  
WHEN 7 THEN 'Zabbix agent (active) check'  
WHEN 8 THEN 'Aggregate'  
WHEN 9 THEN 'HTTP test (web monitoring scenario step)'  
WHEN 10 THEN 'External check'  
WHEN 11 THEN 'Database monitor'  
WHEN 12 THEN 'IPMI agent'  
WHEN 13 THEN 'SSH agent'  
WHEN 14 THEN 'TELNET agent'  
WHEN 15 THEN 'Calculated'  
WHEN 16 THEN 'JMX agent'  
WHEN 17 THEN 'SNMP trap'  
WHEN 18 THEN 'Dependent item'  
WHEN 19 THEN 'HTTP agent'  
WHEN 20 THEN 'SNMP agent'  
WHEN 21 THEN 'Script item'  
END AS type,COUNT(*)  
FROM items  
JOIN hosts ON (hosts.hostid=items.hostid)  
WHERE hosts.status=0  
AND items.status=0  
GROUP BY items.type  
ORDER BY COUNT(*) DESC;</code></pre>
<p>Download this section: <a href="src/32.sql">https://aigarskadikis.github.io/src/32.sql</a><br />
Fancy syntax highlighter? Read same page on GitHub: <a href="https://github.com/aigarskadikis/aigarskadikis.github.io/blob/main/src/32.sql" target="_blank">https://github.com/aigarskadikis/aigarskadikis.github.io/blob/main/src/32.sql</a></p>
</div>
<input type="radio" name="tabs" id="34"><label for="34">34.sql</label><div class="tab">
Show items by proxy<pre><code>SELECT COUNT(*),proxy.host AS proxy,items.type 
FROM items 
JOIN hosts ON (items.hostid=hosts.hostid) 
JOIN hosts proxy ON (hosts.proxy_hostid=proxy.hostid) 
WHERE hosts.status = 0 
AND items.status = 0 
AND proxy.status IN (5,6) 
GROUP BY 2,3 
ORDER BY 2,3;</code></pre>
Devices and it's status<pre><code>SELECT proxy.host AS proxy, hosts.host, interface.ip, interface.dns, interface.useip, 
CASE hosts.available 
WHEN 0 THEN 'unknown'  
WHEN 1 THEN 'available' 
WHEN 2 THEN 'down' 
END AS "status", 
CASE interface.type 
WHEN 1 THEN 'ZBX' 
WHEN 2 THEN 'SNMP' 
WHEN 3 THEN 'IPMI' 
WHEN 4 THEN 'JMX' 
END AS "type", 
hosts.error 
FROM hosts 
JOIN interface ON interface.hostid=hosts.hostid 
LEFT JOIN hosts proxy ON hosts.proxy_hostid=proxy.hostid 
WHERE hosts.status=0 
AND interface.main=1;</code></pre>
Items in use<pre><code>SELECT CASE items.type  
WHEN 0 THEN 'Zabbix agent'  
WHEN 1 THEN 'SNMPv1 agent'  
WHEN 2 THEN 'Zabbix trapper'  
WHEN 3 THEN 'Simple check'  
WHEN 4 THEN 'SNMPv2 agent'  
WHEN 5 THEN 'Zabbix internal'  
WHEN 6 THEN 'SNMPv3 agent'  
WHEN 7 THEN 'Zabbix agent (active) check'  
WHEN 8 THEN 'Aggregate'  
WHEN 9 THEN 'HTTP test (web monitoring scenario step)'  
WHEN 10 THEN 'External check'  
WHEN 11 THEN 'Database monitor'  
WHEN 12 THEN 'IPMI agent'  
WHEN 13 THEN 'SSH agent'  
WHEN 14 THEN 'TELNET agent'  
WHEN 15 THEN 'Calculated'  
WHEN 16 THEN 'JMX agent'  
WHEN 17 THEN 'SNMP trap'  
WHEN 18 THEN 'Dependent item'  
WHEN 19 THEN 'HTTP agent'  
WHEN 20 THEN 'SNMP agent'  
WHEN 21 THEN 'Script item'  
END AS type,COUNT(*)  
FROM items  
JOIN hosts ON (hosts.hostid=items.hostid)  
WHERE hosts.status=0  
AND items.status=0  
GROUP BY items.type  
ORDER BY COUNT(*) DESC;</code></pre>
<p>Download this section: <a href="src/34.sql">https://aigarskadikis.github.io/src/34.sql</a><br />
Fancy syntax highlighter? Read same page on GitHub: <a href="https://github.com/aigarskadikis/aigarskadikis.github.io/blob/main/src/34.sql" target="_blank">https://github.com/aigarskadikis/aigarskadikis.github.io/blob/main/src/34.sql</a></p>
</div>
<input type="radio" name="tabs" id="40"><label for="40">40.sql</label><div class="tab">
Active problems, including Zabbix internal problems (item unsupported, trigger unsupported)<pre><code>SELECT COUNT(*),source,object,severity FROM problem GROUP BY 2,3,4 ORDER BY severity;</code></pre>
Unreachable ZBX host<pre><code>SELECT proxy.host AS proxy, 
hosts.host, 
hosts.error AS hostError, 
CONCAT('hosts.php?form=update&hostid=',hosts.hostid) AS goTo 
FROM hosts 
LEFT JOIN hosts proxy ON (hosts.proxy_hostid=proxy.hostid) 
WHERE hosts.status=0 
AND LENGTH(hosts.error) > 0;</code></pre>
Unreachable SNMP hosts<pre><code>SELECT proxy.host AS proxy, 
hosts.host, 
hosts.snmp_error AS hostError, 
CONCAT('hosts.php?form=update&hostid=',hosts.hostid) AS goTo 
FROM hosts 
LEFT JOIN hosts proxy ON (hosts.proxy_hostid=proxy.hostid) 
WHERE hosts.status=0 
AND LENGTH(hosts.snmp_error) > 0;</code></pre>
Show items by proxy<pre><code>SELECT COUNT(*),proxy.host AS proxy,items.type 
FROM items 
JOIN hosts ON (items.hostid=hosts.hostid) 
JOIN hosts proxy ON (hosts.proxy_hostid=proxy.hostid) 
WHERE hosts.status = 0 
AND items.status = 0 
AND proxy.status IN (5,6) 
GROUP BY 2,3 
ORDER BY 2,3;</code></pre>
Which internal event is spamming database<pre><code>SELECT 
CASE object 
WHEN 0 THEN 'Trigger expression' 
WHEN 4 THEN 'Data collection' 
WHEN 5 THEN 'LLD rule' 
END AS object, 
objectid,value,name,COUNT(*) FROM events 
WHERE source=3 AND LENGTH(name) > 0 
AND clock > UNIX_TIMESTAMP(NOW()-INTERVAL 10 DAY) 
GROUP BY 1,2,3,4 ORDER BY 5 DESC LIMIT 20;</code></pre>
Devices and it's status<pre><code>SELECT proxy.host AS proxy, hosts.host, interface.ip, interface.dns, interface.useip, 
CASE hosts.available 
WHEN 0 THEN 'unknown'  
WHEN 1 THEN 'available' 
WHEN 2 THEN 'down' 
END AS "status", 
CASE interface.type 
WHEN 1 THEN 'ZBX' 
WHEN 2 THEN 'SNMP' 
WHEN 3 THEN 'IPMI' 
WHEN 4 THEN 'JMX' 
END AS "type", 
hosts.error 
FROM hosts 
JOIN interface ON interface.hostid=hosts.hostid 
LEFT JOIN hosts proxy ON hosts.proxy_hostid=proxy.hostid 
WHERE hosts.status=0 
AND interface.main=1;</code></pre>
Items in use<pre><code>SELECT CASE items.type  
WHEN 0 THEN 'Zabbix agent'  
WHEN 1 THEN 'SNMPv1 agent'  
WHEN 2 THEN 'Zabbix trapper'  
WHEN 3 THEN 'Simple check'  
WHEN 4 THEN 'SNMPv2 agent'  
WHEN 5 THEN 'Zabbix internal'  
WHEN 6 THEN 'SNMPv3 agent'  
WHEN 7 THEN 'Zabbix agent (active) check'  
WHEN 8 THEN 'Aggregate'  
WHEN 9 THEN 'HTTP test (web monitoring scenario step)'  
WHEN 10 THEN 'External check'  
WHEN 11 THEN 'Database monitor'  
WHEN 12 THEN 'IPMI agent'  
WHEN 13 THEN 'SSH agent'  
WHEN 14 THEN 'TELNET agent'  
WHEN 15 THEN 'Calculated'  
WHEN 16 THEN 'JMX agent'  
WHEN 17 THEN 'SNMP trap'  
WHEN 18 THEN 'Dependent item'  
WHEN 19 THEN 'HTTP agent'  
WHEN 20 THEN 'SNMP agent'  
WHEN 21 THEN 'Script item'  
END AS type,COUNT(*)  
FROM items  
JOIN hosts ON (hosts.hostid=items.hostid)  
WHERE hosts.status=0  
AND items.status=0  
GROUP BY items.type  
ORDER BY COUNT(*) DESC;</code></pre>
All events closed by global correlation rule<pre><code>SELECT 
repercussion.clock, 
repercussion.name, 
rootCause.clock, 
rootCause.name 
FROM events repercussion 
JOIN event_recovery ON (event_recovery.eventid=repercussion.eventid) 
JOIN events rootCause ON (rootCause.eventid=event_recovery.c_eventid) 
WHERE event_recovery.c_eventid IS NOT NULL 
ORDER BY repercussion.clock ASC;</code></pre>
All active data collector items on enabled hosts<pre><code>SELECT 
hosts.host, 
items.name, 
items.type, 
items.key_, 
items.delay 
FROM items 
JOIN hosts ON (hosts.hostid=items.hostid) 
WHERE hosts.status=0 
AND items.status=0 
ORDER BY 1,2,3,4,5;</code></pre>
Owner of LLD dependent item. What is interval for owner<pre><code>SELECT master_itemid.key_,master_itemid.delay,COUNT(*) FROM items 
JOIN hosts ON (hosts.hostid=items.hostid) 
JOIN items master_itemid ON (master_itemid.itemid=items.master_itemid) 
WHERE items.flags=1 AND hosts.status=0 AND items.status=0 AND master_itemid.status=0 AND items.type=18 
GROUP BY 1,2 ORDER BY 3 DESC;</code></pre>
Frequency of LLD rule for enabled hosts and enabled items discoveries for only monitored hosts<pre><code>SELECT type,delay,COUNT(*) FROM items 
JOIN hosts ON (hosts.hostid=items.hostid) 
WHERE items.flags=1 AND hosts.status=0 AND items.status=0 
GROUP BY 1,2 ORDER BY 1,2;</code></pre>
<p>Download this section: <a href="src/40.sql">https://aigarskadikis.github.io/src/40.sql</a><br />
Fancy syntax highlighter? Read same page on GitHub: <a href="https://github.com/aigarskadikis/aigarskadikis.github.io/blob/main/src/40.sql" target="_blank">https://github.com/aigarskadikis/aigarskadikis.github.io/blob/main/src/40.sql</a></p>
</div>
<input type="radio" name="tabs" id="42"><label for="42">42.sql</label><div class="tab">
Unreachable ZBX host<pre><code>SELECT proxy.host AS proxy, 
hosts.host, 
hosts.error AS hostError, 
CONCAT('hosts.php?form=update&hostid=',hosts.hostid) AS goTo 
FROM hosts 
LEFT JOIN hosts proxy ON (hosts.proxy_hostid=proxy.hostid) 
WHERE hosts.status=0 
AND LENGTH(hosts.error) > 0;</code></pre>
Unreachable SNMP hosts<pre><code>SELECT proxy.host AS proxy, 
hosts.host, 
hosts.snmp_error AS hostError, 
CONCAT('hosts.php?form=update&hostid=',hosts.hostid) AS goTo 
FROM hosts 
LEFT JOIN hosts proxy ON (hosts.proxy_hostid=proxy.hostid) 
WHERE hosts.status=0 
AND LENGTH(hosts.snmp_error) > 0;</code></pre>
Show items by proxy<pre><code>SELECT COUNT(*),proxy.host AS proxy,items.type 
FROM items 
JOIN hosts ON (items.hostid=hosts.hostid) 
JOIN hosts proxy ON (hosts.proxy_hostid=proxy.hostid) 
WHERE hosts.status = 0 
AND items.status = 0 
AND proxy.status IN (5,6) 
GROUP BY 2,3 
ORDER BY 2,3;</code></pre>
Devices and it's status<pre><code>SELECT proxy.host AS proxy, hosts.host, interface.ip, interface.dns, interface.useip, 
CASE hosts.available 
WHEN 0 THEN 'unknown'  
WHEN 1 THEN 'available' 
WHEN 2 THEN 'down' 
END AS "status", 
CASE interface.type 
WHEN 1 THEN 'ZBX' 
WHEN 2 THEN 'SNMP' 
WHEN 3 THEN 'IPMI' 
WHEN 4 THEN 'JMX' 
END AS "type", 
hosts.error 
FROM hosts 
JOIN interface ON interface.hostid=hosts.hostid 
LEFT JOIN hosts proxy ON hosts.proxy_hostid=proxy.hostid 
WHERE hosts.status=0 
AND interface.main=1;</code></pre>
Items in use<pre><code>SELECT CASE items.type  
WHEN 0 THEN 'Zabbix agent'  
WHEN 1 THEN 'SNMPv1 agent'  
WHEN 2 THEN 'Zabbix trapper'  
WHEN 3 THEN 'Simple check'  
WHEN 4 THEN 'SNMPv2 agent'  
WHEN 5 THEN 'Zabbix internal'  
WHEN 6 THEN 'SNMPv3 agent'  
WHEN 7 THEN 'Zabbix agent (active) check'  
WHEN 8 THEN 'Aggregate'  
WHEN 9 THEN 'HTTP test (web monitoring scenario step)'  
WHEN 10 THEN 'External check'  
WHEN 11 THEN 'Database monitor'  
WHEN 12 THEN 'IPMI agent'  
WHEN 13 THEN 'SSH agent'  
WHEN 14 THEN 'TELNET agent'  
WHEN 15 THEN 'Calculated'  
WHEN 16 THEN 'JMX agent'  
WHEN 17 THEN 'SNMP trap'  
WHEN 18 THEN 'Dependent item'  
WHEN 19 THEN 'HTTP agent'  
WHEN 20 THEN 'SNMP agent'  
WHEN 21 THEN 'Script item'  
END AS type,COUNT(*)  
FROM items  
JOIN hosts ON (hosts.hostid=items.hostid)  
WHERE hosts.status=0  
AND items.status=0  
GROUP BY items.type  
ORDER BY COUNT(*) DESC;</code></pre>
Owner of LLD dependent item. What is interval for owner<pre><code>SELECT master_itemid.key_,master_itemid.delay,COUNT(*) FROM items 
JOIN hosts ON (hosts.hostid=items.hostid) 
JOIN items master_itemid ON (master_itemid.itemid=items.master_itemid) 
WHERE items.flags=1 AND hosts.status=0 AND items.status=0 AND master_itemid.status=0 AND items.type=18 
GROUP BY 1,2 ORDER BY 3 DESC;</code></pre>
<p>Download this section: <a href="src/42.sql">https://aigarskadikis.github.io/src/42.sql</a><br />
Fancy syntax highlighter? Read same page on GitHub: <a href="https://github.com/aigarskadikis/aigarskadikis.github.io/blob/main/src/42.sql" target="_blank">https://github.com/aigarskadikis/aigarskadikis.github.io/blob/main/src/42.sql</a></p>
</div>
<input type="radio" name="tabs" id="44"><label for="44">44.sql</label><div class="tab">
Unreachable ZBX host<pre><code>SELECT proxy.host AS proxy, 
hosts.host, 
hosts.error AS hostError, 
CONCAT('hosts.php?form=update&hostid=',hosts.hostid) AS goTo 
FROM hosts 
LEFT JOIN hosts proxy ON (hosts.proxy_hostid=proxy.hostid) 
WHERE hosts.status=0 
AND LENGTH(hosts.error) > 0;</code></pre>
Unreachable SNMP hosts<pre><code>SELECT proxy.host AS proxy, 
hosts.host, 
hosts.snmp_error AS hostError, 
CONCAT('hosts.php?form=update&hostid=',hosts.hostid) AS goTo 
FROM hosts 
LEFT JOIN hosts proxy ON (hosts.proxy_hostid=proxy.hostid) 
WHERE hosts.status=0 
AND LENGTH(hosts.snmp_error) > 0;</code></pre>
Show items by proxy<pre><code>SELECT COUNT(*),proxy.host AS proxy,items.type 
FROM items 
JOIN hosts ON (items.hostid=hosts.hostid) 
JOIN hosts proxy ON (hosts.proxy_hostid=proxy.hostid) 
WHERE hosts.status = 0 
AND items.status = 0 
AND proxy.status IN (5,6) 
GROUP BY 2,3 
ORDER BY 2,3;</code></pre>
Devices and it's status<pre><code>SELECT proxy.host AS proxy, hosts.host, interface.ip, interface.dns, interface.useip, 
CASE hosts.available 
WHEN 0 THEN 'unknown'  
WHEN 1 THEN 'available' 
WHEN 2 THEN 'down' 
END AS "status", 
CASE interface.type 
WHEN 1 THEN 'ZBX' 
WHEN 2 THEN 'SNMP' 
WHEN 3 THEN 'IPMI' 
WHEN 4 THEN 'JMX' 
END AS "type", 
hosts.error 
FROM hosts 
JOIN interface ON interface.hostid=hosts.hostid 
LEFT JOIN hosts proxy ON hosts.proxy_hostid=proxy.hostid 
WHERE hosts.status=0 
AND interface.main=1;</code></pre>
Items in use<pre><code>SELECT CASE items.type  
WHEN 0 THEN 'Zabbix agent'  
WHEN 1 THEN 'SNMPv1 agent'  
WHEN 2 THEN 'Zabbix trapper'  
WHEN 3 THEN 'Simple check'  
WHEN 4 THEN 'SNMPv2 agent'  
WHEN 5 THEN 'Zabbix internal'  
WHEN 6 THEN 'SNMPv3 agent'  
WHEN 7 THEN 'Zabbix agent (active) check'  
WHEN 8 THEN 'Aggregate'  
WHEN 9 THEN 'HTTP test (web monitoring scenario step)'  
WHEN 10 THEN 'External check'  
WHEN 11 THEN 'Database monitor'  
WHEN 12 THEN 'IPMI agent'  
WHEN 13 THEN 'SSH agent'  
WHEN 14 THEN 'TELNET agent'  
WHEN 15 THEN 'Calculated'  
WHEN 16 THEN 'JMX agent'  
WHEN 17 THEN 'SNMP trap'  
WHEN 18 THEN 'Dependent item'  
WHEN 19 THEN 'HTTP agent'  
WHEN 20 THEN 'SNMP agent'  
WHEN 21 THEN 'Script item'  
END AS type,COUNT(*)  
FROM items  
JOIN hosts ON (hosts.hostid=items.hostid)  
WHERE hosts.status=0  
AND items.status=0  
GROUP BY items.type  
ORDER BY COUNT(*) DESC;</code></pre>
Owner of LLD dependent item. What is interval for owner<pre><code>SELECT master_itemid.key_,master_itemid.delay,COUNT(*) FROM items 
JOIN hosts ON (hosts.hostid=items.hostid) 
JOIN items master_itemid ON (master_itemid.itemid=items.master_itemid) 
WHERE items.flags=1 AND hosts.status=0 AND items.status=0 AND master_itemid.status=0 AND items.type=18 
GROUP BY 1,2 ORDER BY 3 DESC;</code></pre>
For items which are currently disabled, clean the error message in database. This will help to locate what really is not working and why<pre><code>UPDATE item_rtdata SET error='' WHERE itemid IN ( 
SELECT items.itemid FROM item_rtdata, items, hosts 
WHERE item_rtdata.state=1 AND hosts.status=0 AND items.status=1 
AND item_rtdata.itemid=items.itemid 
AND hosts.hostid=items.hostid 
);</code></pre>
For items which are currently disabled, reset the state as supported. This will help to locate what really is not working and why. Item will remain disabled<pre><code>UPDATE item_rtdata SET state=0 WHERE itemid IN ( 
SELECT items.itemid FROM item_rtdata, items, hosts 
WHERE item_rtdata.state=1 AND hosts.status=0 AND items.status=1 
AND item_rtdata.itemid=items.itemid 
AND hosts.hostid=items.hostid 
);</code></pre>
Print error message for enabled hosts and enabled data collector items<pre><code>SELECT hosts.host, items.name, item_rtdata.error FROM item_rtdata, items, hosts 
WHERE item_rtdata.state=1 AND hosts.status=0 AND items.status=0 
AND item_rtdata.itemid=items.itemid 
AND hosts.hostid=items.hostid;</code></pre>
<p>Download this section: <a href="src/44.sql">https://aigarskadikis.github.io/src/44.sql</a><br />
Fancy syntax highlighter? Read same page on GitHub: <a href="https://github.com/aigarskadikis/aigarskadikis.github.io/blob/main/src/44.sql" target="_blank">https://github.com/aigarskadikis/aigarskadikis.github.io/blob/main/src/44.sql</a></p>
</div>
<input type="radio" name="tabs" id="50" checked="checked"><label for="50">50.sql</label><div class="tab">
How many user groups has debug mode 1<pre><code>SELECT COUNT(*) FROM usrgrp WHERE debug_mode=1;</code></pre>
Active problems, including Zabbix internal problems (item unsupported, trigger unsupported)<pre><code>SELECT COUNT(*),source,object,severity FROM problem GROUP BY 2,3,4 ORDER BY severity;</code></pre>
Unreachable ZBX host<pre><code>SELECT proxy.host AS proxy, 
hosts.host, 
hosts.error AS hostError, 
CONCAT('hosts.php?form=update&hostid=',hosts.hostid) AS goTo 
FROM hosts 
LEFT JOIN hosts proxy ON (hosts.proxy_hostid=proxy.hostid) 
WHERE hosts.status=0 
AND LENGTH(hosts.error) > 0;</code></pre>
Unreachable SNMP hosts<pre><code>SELECT proxy.host AS proxy, 
hosts.host, 
hosts.snmp_error AS hostError, 
CONCAT('hosts.php?form=update&hostid=',hosts.hostid) AS goTo 
FROM hosts 
LEFT JOIN hosts proxy ON (hosts.proxy_hostid=proxy.hostid) 
WHERE hosts.status=0 
AND LENGTH(hosts.snmp_error) > 0;</code></pre>
Show items by proxy<pre><code>SELECT COUNT(*),proxy.host AS proxy,items.type 
FROM items 
JOIN hosts ON (items.hostid=hosts.hostid) 
JOIN hosts proxy ON (hosts.proxy_hostid=proxy.hostid) 
WHERE hosts.status = 0 
AND items.status = 0 
AND proxy.status IN (5,6) 
GROUP BY 2,3 
ORDER BY 2,3;</code></pre>
Which internal event is spamming database<pre><code>SELECT 
CASE object 
WHEN 0 THEN 'Trigger expression' 
WHEN 4 THEN 'Data collection' 
WHEN 5 THEN 'LLD rule' 
END AS object, 
objectid,value,name,COUNT(*) FROM events 
WHERE source=3 AND LENGTH(name) > 0 
AND clock > UNIX_TIMESTAMP(NOW()-INTERVAL 10 DAY) 
GROUP BY 1,2,3,4 ORDER BY 5 DESC LIMIT 20;</code></pre>
Difference between installed macros between host VS template VS nested/child templates<pre><code>SELECT hm1.macro AS Macro, child.host AS owner, hm2.value AS defaultValue, parent.host AS OverrideInstalled, hm1.value AS OverrideValue FROM hosts parent, hosts child, hosts_templates rel, hostmacro hm1, hostmacro hm2 WHERE parent.hostid=rel.hostid AND child.hostid=rel.templateid AND hm1.hostid = parent.hostid AND hm2.hostid = child.hostid AND hm1.macro = hm2.macro AND parent.flags=0 AND child.flags=0 AND hm1.value <> hm2.value;</code></pre>
Detect if there is difference between template macro and host macro. This is surface level detection. it does not take care of values between nested templates<pre><code>SELECT b.host, 
hm2.macro, 
hm2.value AS templateValue, 
h.host, 
hm1.macro, 
hm1.value AS hostValue 
FROM hosts_templates, 
hosts h, 
hosts b, 
hostmacro hm1, 
hostmacro hm2, 
interface 
WHERE hosts_templates.hostid = h.hostid 
AND hosts_templates.templateid = b.hostid 
AND interface.hostid = h.hostid 
AND hm1.hostid = h.hostid 
AND hm2.hostid = hosts_templates.templateid 
AND hm1.macro = hm2.macro 
AND hm1.value <> hm2.value;</code></pre>
Devices and it's status<pre><code>SELECT proxy.host AS proxy, hosts.host, interface.ip, interface.dns, interface.useip, 
CASE hosts.available 
WHEN 0 THEN 'unknown'  
WHEN 1 THEN 'available' 
WHEN 2 THEN 'down' 
END AS "status", 
CASE interface.type 
WHEN 1 THEN 'ZBX' 
WHEN 2 THEN 'SNMP' 
WHEN 3 THEN 'IPMI' 
WHEN 4 THEN 'JMX' 
END AS "type", 
hosts.error 
FROM hosts 
JOIN interface ON interface.hostid=hosts.hostid 
LEFT JOIN hosts proxy ON hosts.proxy_hostid=proxy.hostid 
WHERE hosts.status=0 
AND interface.main=1;</code></pre>
Items in use<pre><code>SELECT CASE items.type  
WHEN 0 THEN 'Zabbix agent'  
WHEN 1 THEN 'SNMPv1 agent'  
WHEN 2 THEN 'Zabbix trapper'  
WHEN 3 THEN 'Simple check'  
WHEN 4 THEN 'SNMPv2 agent'  
WHEN 5 THEN 'Zabbix internal'  
WHEN 6 THEN 'SNMPv3 agent'  
WHEN 7 THEN 'Zabbix agent (active) check'  
WHEN 8 THEN 'Aggregate'  
WHEN 9 THEN 'HTTP test (web monitoring scenario step)'  
WHEN 10 THEN 'External check'  
WHEN 11 THEN 'Database monitor'  
WHEN 12 THEN 'IPMI agent'  
WHEN 13 THEN 'SSH agent'  
WHEN 14 THEN 'TELNET agent'  
WHEN 15 THEN 'Calculated'  
WHEN 16 THEN 'JMX agent'  
WHEN 17 THEN 'SNMP trap'  
WHEN 18 THEN 'Dependent item'  
WHEN 19 THEN 'HTTP agent'  
WHEN 20 THEN 'SNMP agent'  
WHEN 21 THEN 'Script item'  
END AS type,COUNT(*)  
FROM items  
JOIN hosts ON (hosts.hostid=items.hostid)  
WHERE hosts.status=0  
AND items.status=0  
GROUP BY items.type  
ORDER BY COUNT(*) DESC;</code></pre>
Exceptions in update interval. When a user install a custom update frequency in a host level and the frequency differs from template level. This query also detects difference between nested templates<pre><code>SELECT h1.host AS exceptionInstalled, 
i1.name, 
i1.key_, 
i1.delay, 
h2.host AS differesFromTemplate, 
i2.name, 
i2.key_, 
i2.delay 
FROM items i1 
JOIN items i2 ON (i2.itemid=i1.templateid) 
JOIN hosts h1 ON (h1.hostid=i1.hostid) 
JOIN hosts h2 ON (h2.hostid=i2.hostid) 
WHERE i1.delay <> i2.delay;</code></pre>
All events closed by global correlation rule<pre><code>SELECT 
repercussion.clock, 
repercussion.name, 
rootCause.clock, 
rootCause.name 
FROM events repercussion 
JOIN event_recovery ON (event_recovery.eventid=repercussion.eventid) 
JOIN events rootCause ON (rootCause.eventid=event_recovery.c_eventid) 
WHERE event_recovery.c_eventid IS NOT NULL 
ORDER BY repercussion.clock ASC;</code></pre>
All active data collector items on enabled hosts<pre><code>SELECT 
hosts.host, 
items.name, 
items.type, 
items.key_, 
items.delay 
FROM items 
JOIN hosts ON (hosts.hostid=items.hostid) 
WHERE hosts.status=0 
AND items.status=0 
ORDER BY 1,2,3,4,5;</code></pre>
Owner of LLD dependent item. What is interval for owner<pre><code>SELECT master_itemid.key_,master_itemid.delay,COUNT(*) FROM items 
JOIN hosts ON (hosts.hostid=items.hostid) 
JOIN items master_itemid ON (master_itemid.itemid=items.master_itemid) 
WHERE items.flags=1 AND hosts.status=0 AND items.status=0 AND master_itemid.status=0 AND items.type=18 
GROUP BY 1,2 ORDER BY 3 DESC;</code></pre>
Enabled and disabled LLD items, its key<pre><code>SELECT items.type,items.key_,items.delay,items.status,COUNT(*) FROM items 
JOIN hosts ON (hosts.hostid=items.hostid) WHERE items.flags=1 AND hosts.status=0 
GROUP BY 1,2,3,4 ORDER BY 1,2,3,4;</code></pre>
Which dashboard has been using host group id:2 for the input<pre><code>SELECT DISTINCT dashboard.name,hstgrp.name FROM widget_field 
JOIN widget ON (widget.widgetid=widget_field.widgetid) 
JOIN dashboard ON (dashboard.dashboardid=widget.dashboardid) 
JOIN hstgrp ON (hstgrp.groupid=widget_field.value_groupid) 
WHERE widget_field.value_groupid IN (2);</code></pre>
Zabbix agent hitting the central server<pre><code>SELECT hosts.host AS proxy, 
CASE autoreg_host.flags 
WHEN 0 THEN 'IP address, do not update host interface' 
WHEN 1 THEN 'IP address, update default host interface' 
WHEN 2 THEN 'DNS name, update default host interface' 
END AS "connect using", 
CASE autoreg_host.tls_accepted 
WHEN 1 THEN 'Unencrypted' 
WHEN 2 THEN 'TLS with PSK' 
END AS "Encryption", 
COUNT(*) AS "amount of hosts" 
FROM autoreg_host 
JOIN hosts ON (hosts.hostid=autoreg_host.proxy_hostid) 
GROUP BY 1,2,3 ORDER BY 1,2,3;</code></pre>
Items without a template<pre><code>SELECT hosts.host, items.key_ FROM items 
JOIN hosts ON (hosts.hostid=items.hostid) 
WHERE hosts.status=0 AND hosts.flags=0 
AND items.status=0 AND items.templateid IS NULL AND items.flags=0;</code></pre>
Hosts with multiple interfaces<pre><code>SELECT hosts.host FROM interface 
JOIN hosts ON (hosts.hostid=interface.hostid) 
WHERE hosts.flags=0 
GROUP BY hosts.host 
HAVING COUNT(interface.interfaceid) > 1;</code></pre>
PostgreSQL<pre><code>SELECT proxy.host AS proxy, hosts.host, ARRAY_TO_STRING(ARRAY_AGG(template.host),', ') AS templates FROM hosts JOIN hosts_templates ON (hosts_templates.hostid=hosts.hostid) LEFT JOIN hosts proxy ON (hosts.proxy_hostid=proxy.hostid) LEFT JOIN hosts template ON (hosts_templates.templateid=template.hostid) WHERE hosts.status IN (0,1) AND hosts.flags=0 GROUP BY 1,2 ORDER BY 1,3,2;</code></pre>
MySQL<pre><code>SELECT proxy.host AS proxy, hosts.host, GROUP_CONCAT(template.host SEPARATOR ', ') AS templates FROM hosts JOIN hosts_templates ON (hosts_templates.hostid=hosts.hostid) LEFT JOIN hosts proxy ON (hosts.proxy_hostid=proxy.hostid) LEFT JOIN hosts template ON (hosts_templates.templateid=template.hostid) WHERE hosts.status IN (0,1) AND hosts.flags=0 GROUP BY 1,2 ORDER BY 1,3,2;</code></pre>
Which action is responsible<pre><code>SELECT FROM_UNIXTIME(events.clock) AS 'time', 
CASE events.severity 
WHEN 0 THEN 'NOT_CLASSIFIED' 
WHEN 1 THEN 'INFORMATION' 
WHEN 2 THEN 'WARNING' 
WHEN 3 THEN 'AVERAGE' 
WHEN 4 THEN 'HIGH' 
WHEN 5 THEN 'DISASTER' 
END AS severity, 
CASE events.acknowledged 
WHEN 0 THEN 'NO' 
WHEN 1 THEN 'YES' 
END AS acknowledged, 
CASE events.value 
WHEN 0 THEN 'OK' 
WHEN 1 THEN 'PROBLEM ' 
END AS trigger_status, 
events.name AS 'event', 
actions.name AS 'action' 
FROM events 
JOIN alerts ON (alerts.eventid=events.eventid) 
JOIN actions ON (actions.actionid=alerts.actionid) 
WHERE events.source=0 
AND events.object=0 
ORDER BY events.clock DESC 
LIMIT 10;</code></pre>
Non-working LLD rules<pre><code>SELECT 
hosts.name AS hostName, 
items.key_ AS itemKey, 
problem.name AS LLDerror, 
CONCAT('host_discovery.php?form=update&itemid=',problem.objectid) AS goTo 
FROM problem 
JOIN items ON (items.itemid=problem.objectid) 
JOIN hosts ON (hosts.hostid=items.hostid) 
WHERE problem.source > 0 AND problem.object=5;</code></pre>
Non-working data collector items<pre><code>SELECT 
hosts.name AS hostName, 
items.key_ AS itemKey, 
problem.name AS DataCollectorError, 
CONCAT('items.php?form=update&itemid=',problem.objectid) AS goTo 
FROM problem 
JOIN items ON (items.itemid=problem.objectid) 
JOIN hosts ON (hosts.hostid=items.hostid) 
WHERE problem.source > 0 AND problem.object=4;</code></pre>
Trigger evaluation problems<pre><code>SELECT 
DISTINCT CONCAT('triggers.php?form=update&triggerid=',problem.objectid) AS goTo, 
hosts.name AS hostName, 
triggers.description AS triggerTitle, 
problem.name AS TriggerEvaluationError 
FROM problem 
JOIN triggers ON (triggers.triggerid=problem.objectid) 
JOIN functions ON (functions.triggerid=triggers.triggerid) 
JOIN items ON (items.itemid=functions.itemid) 
JOIN hosts ON (hosts.hostid=items.hostid) 
WHERE problem.source > 0 AND problem.object=0;</code></pre>
User sessions<pre><code>SELECT COUNT(*),users.alias 
FROM sessions 
JOIN users ON (users.userid=sessions.userid) 
GROUP BY 2 ORDER BY 1 ASC;</code></pre>
Open problems<pre><code>SELECT COUNT(*) AS count, 
CASE 
WHEN source = 0 THEN 'surface' 
WHEN source > 0 THEN 'internal' 
END AS level, 
CASE 
WHEN source=0 AND object=0 THEN 'trigger in a problem state' 
WHEN source=3 AND object=0 THEN 'cannot evaluate trigger expression' 
WHEN source=3 AND object=4 THEN 'data collection not working' 
WHEN source=3 AND object=5 THEN 'low level discovery not perfect' 
END AS problemCategory 
FROM problem GROUP BY 2,3 
ORDER BY 2 DESC;</code></pre>
Item update frequency<pre><code>SELECT h2.host AS Source, 
i2.name AS itemName, 
i2.key_ AS itemKey, 
i2.delay AS OriginalUpdateFrequency, 
h1.host AS exceptionInstalledOn, 
i1.delay AS FrequencyChild, 
CASE 
WHEN i1.flags=1 THEN 'LLD rule' 
WHEN i1.flags IN (0,4) THEN 'data collection' 
END AS itemCategory, 
CASE 
WHEN i1.flags=1 THEN CONCAT('host_discovery.php?form=update&context=host&itemid=',i1.itemid) 
WHEN i1.flags IN (0,4) THEN CONCAT('items.php?form=update&context=host&hostid=',h1.hostid,'&itemid=',i1.itemid) 
END AS goTo 
FROM items i1 
JOIN items i2 ON (i2.itemid=i1.templateid) 
JOIN hosts h1 ON (h1.hostid=i1.hostid) 
JOIN hosts h2 ON (h2.hostid=i2.hostid) 
WHERE i1.delay <> i2.delay;</code></pre>
Unsupported items and LLD rules<pre><code>SELECT DISTINCT i.key_,COALESCE(ir.error,'') AS error FROM hosts h,items i LEFT JOIN item_rtdata ir ON i.itemid=ir.itemid WHERE i.type<>9 AND i.flags IN (0,1,4) AND h.hostid=i.hostid AND h.status<>3 AND i.status=0 AND ir.state=1 LIMIT 5001;</code></pre>
For items which are currently disabled, clean the error message in database. This will help to locate what really is not working and why<pre><code>UPDATE item_rtdata SET error='' WHERE itemid IN ( 
SELECT items.itemid FROM item_rtdata, items, hosts 
WHERE item_rtdata.state=1 AND hosts.status=0 AND items.status=1 
AND item_rtdata.itemid=items.itemid 
AND hosts.hostid=items.hostid 
);</code></pre>
For items which are currently disabled, reset the state as supported. This will help to locate what really is not working and why. Item will remain disabled<pre><code>UPDATE item_rtdata SET state=0 WHERE itemid IN ( 
SELECT items.itemid FROM item_rtdata, items, hosts 
WHERE item_rtdata.state=1 AND hosts.status=0 AND items.status=1 
AND item_rtdata.itemid=items.itemid 
AND hosts.hostid=items.hostid 
);</code></pre>
Print error message for enabled hosts and enabled data collector items<pre><code>SELECT hosts.host, items.name, item_rtdata.error FROM item_rtdata, items, hosts 
WHERE item_rtdata.state=1 AND hosts.status=0 AND items.status=0 
AND item_rtdata.itemid=items.itemid 
AND hosts.hostid=items.hostid;</code></pre>
Identify item membership. Usefull if that is master item<pre><code>SELECT proxy.host AS proxy, hosts.host, items.name, items.key_, items.delay 
FROM hosts 
LEFT JOIN hosts proxy ON (hosts.proxy_hostid=proxy.hostid) 
JOIN items ON (items.hostid=hosts.hostid) 
WHERE items.itemid IN (12345,5678);</code></pre>
<p>Download this section: <a href="src/50.sql">https://aigarskadikis.github.io/src/50.sql</a><br />
Fancy syntax highlighter? Read same page on GitHub: <a href="https://github.com/aigarskadikis/aigarskadikis.github.io/blob/main/src/50.sql" target="_blank">https://github.com/aigarskadikis/aigarskadikis.github.io/blob/main/src/50.sql</a></p>
</div>
<input type="radio" name="tabs" id="52"><label for="52">52.sql</label><div class="tab">
How many user groups has debug mode 1<pre><code>SELECT COUNT(*) FROM usrgrp WHERE debug_mode=1;</code></pre>
Unreachable ZBX host<pre><code>SELECT proxy.host AS proxy, 
hosts.host, 
hosts.error AS hostError, 
CONCAT('hosts.php?form=update&hostid=',hosts.hostid) AS goTo 
FROM hosts 
LEFT JOIN hosts proxy ON (hosts.proxy_hostid=proxy.hostid) 
WHERE hosts.status=0 
AND LENGTH(hosts.error) > 0;</code></pre>
Unreachable SNMP hosts<pre><code>SELECT proxy.host AS proxy, 
hosts.host, 
hosts.snmp_error AS hostError, 
CONCAT('hosts.php?form=update&hostid=',hosts.hostid) AS goTo 
FROM hosts 
LEFT JOIN hosts proxy ON (hosts.proxy_hostid=proxy.hostid) 
WHERE hosts.status=0 
AND LENGTH(hosts.snmp_error) > 0;</code></pre>
Show items by proxy<pre><code>SELECT COUNT(*),proxy.host AS proxy,items.type 
FROM items 
JOIN hosts ON (items.hostid=hosts.hostid) 
JOIN hosts proxy ON (hosts.proxy_hostid=proxy.hostid) 
WHERE hosts.status = 0 
AND items.status = 0 
AND proxy.status IN (5,6) 
GROUP BY 2,3 
ORDER BY 2,3;</code></pre>
Devices and it's status<pre><code>SELECT proxy.host AS proxy, hosts.host, interface.ip, interface.dns, interface.useip, 
CASE hosts.available 
WHEN 0 THEN 'unknown'  
WHEN 1 THEN 'available' 
WHEN 2 THEN 'down' 
END AS "status", 
CASE interface.type 
WHEN 1 THEN 'ZBX' 
WHEN 2 THEN 'SNMP' 
WHEN 3 THEN 'IPMI' 
WHEN 4 THEN 'JMX' 
END AS "type", 
hosts.error 
FROM hosts 
JOIN interface ON interface.hostid=hosts.hostid 
LEFT JOIN hosts proxy ON hosts.proxy_hostid=proxy.hostid 
WHERE hosts.status=0 
AND interface.main=1;</code></pre>
Items in use<pre><code>SELECT CASE items.type  
WHEN 0 THEN 'Zabbix agent'  
WHEN 1 THEN 'SNMPv1 agent'  
WHEN 2 THEN 'Zabbix trapper'  
WHEN 3 THEN 'Simple check'  
WHEN 4 THEN 'SNMPv2 agent'  
WHEN 5 THEN 'Zabbix internal'  
WHEN 6 THEN 'SNMPv3 agent'  
WHEN 7 THEN 'Zabbix agent (active) check'  
WHEN 8 THEN 'Aggregate'  
WHEN 9 THEN 'HTTP test (web monitoring scenario step)'  
WHEN 10 THEN 'External check'  
WHEN 11 THEN 'Database monitor'  
WHEN 12 THEN 'IPMI agent'  
WHEN 13 THEN 'SSH agent'  
WHEN 14 THEN 'TELNET agent'  
WHEN 15 THEN 'Calculated'  
WHEN 16 THEN 'JMX agent'  
WHEN 17 THEN 'SNMP trap'  
WHEN 18 THEN 'Dependent item'  
WHEN 19 THEN 'HTTP agent'  
WHEN 20 THEN 'SNMP agent'  
WHEN 21 THEN 'Script item'  
END AS type,COUNT(*)  
FROM items  
JOIN hosts ON (hosts.hostid=items.hostid)  
WHERE hosts.status=0  
AND items.status=0  
GROUP BY items.type  
ORDER BY COUNT(*) DESC;</code></pre>
Owner of LLD dependent item. What is interval for owner<pre><code>SELECT master_itemid.key_,master_itemid.delay,COUNT(*) FROM items 
JOIN hosts ON (hosts.hostid=items.hostid) 
JOIN items master_itemid ON (master_itemid.itemid=items.master_itemid) 
WHERE items.flags=1 AND hosts.status=0 AND items.status=0 AND master_itemid.status=0 AND items.type=18 
GROUP BY 1,2 ORDER BY 3 DESC;</code></pre>
Enabled and disabled LLD items, its key<pre><code>SELECT items.type,items.key_,items.delay,items.status,COUNT(*) FROM items 
JOIN hosts ON (hosts.hostid=items.hostid) WHERE items.flags=1 AND hosts.status=0 
GROUP BY 1,2,3,4 ORDER BY 1,2,3,4;</code></pre>
Zabbix agent hitting the central server<pre><code>SELECT hosts.host AS proxy, 
CASE autoreg_host.flags 
WHEN 0 THEN 'IP address, do not update host interface' 
WHEN 1 THEN 'IP address, update default host interface' 
WHEN 2 THEN 'DNS name, update default host interface' 
END AS "connect using", 
CASE autoreg_host.tls_accepted 
WHEN 1 THEN 'Unencrypted' 
WHEN 2 THEN 'TLS with PSK' 
END AS "Encryption", 
COUNT(*) AS "amount of hosts" 
FROM autoreg_host 
JOIN hosts ON (hosts.hostid=autoreg_host.proxy_hostid) 
GROUP BY 1,2,3 ORDER BY 1,2,3;</code></pre>
PostgreSQL<pre><code>SELECT proxy.host AS proxy, hosts.host, ARRAY_TO_STRING(ARRAY_AGG(template.host),', ') AS templates FROM hosts JOIN hosts_templates ON (hosts_templates.hostid=hosts.hostid) LEFT JOIN hosts proxy ON (hosts.proxy_hostid=proxy.hostid) LEFT JOIN hosts template ON (hosts_templates.templateid=template.hostid) WHERE hosts.status IN (0,1) AND hosts.flags=0 GROUP BY 1,2 ORDER BY 1,3,2;</code></pre>
MySQL<pre><code>SELECT proxy.host AS proxy, hosts.host, GROUP_CONCAT(template.host SEPARATOR ', ') AS templates FROM hosts JOIN hosts_templates ON (hosts_templates.hostid=hosts.hostid) LEFT JOIN hosts proxy ON (hosts.proxy_hostid=proxy.hostid) LEFT JOIN hosts template ON (hosts_templates.templateid=template.hostid) WHERE hosts.status IN (0,1) AND hosts.flags=0 GROUP BY 1,2 ORDER BY 1,3,2;</code></pre>
For items which are currently disabled, clean the error message in database. This will help to locate what really is not working and why<pre><code>UPDATE item_rtdata SET error='' WHERE itemid IN ( 
SELECT items.itemid FROM item_rtdata, items, hosts 
WHERE item_rtdata.state=1 AND hosts.status=0 AND items.status=1 
AND item_rtdata.itemid=items.itemid 
AND hosts.hostid=items.hostid 
);</code></pre>
For items which are currently disabled, reset the state as supported. This will help to locate what really is not working and why. Item will remain disabled<pre><code>UPDATE item_rtdata SET state=0 WHERE itemid IN ( 
SELECT items.itemid FROM item_rtdata, items, hosts 
WHERE item_rtdata.state=1 AND hosts.status=0 AND items.status=1 
AND item_rtdata.itemid=items.itemid 
AND hosts.hostid=items.hostid 
);</code></pre>
Print error message for enabled hosts and enabled data collector items<pre><code>SELECT hosts.host, items.name, item_rtdata.error FROM item_rtdata, items, hosts 
WHERE item_rtdata.state=1 AND hosts.status=0 AND items.status=0 
AND item_rtdata.itemid=items.itemid 
AND hosts.hostid=items.hostid;</code></pre>
Identify item membership. Usefull if that is master item<pre><code>SELECT proxy.host AS proxy, hosts.host, items.name, items.key_, items.delay 
FROM hosts 
LEFT JOIN hosts proxy ON (hosts.proxy_hostid=proxy.hostid) 
JOIN items ON (items.hostid=hosts.hostid) 
WHERE items.itemid IN (12345,5678);</code></pre>
<p>Download this section: <a href="src/52.sql">https://aigarskadikis.github.io/src/52.sql</a><br />
Fancy syntax highlighter? Read same page on GitHub: <a href="https://github.com/aigarskadikis/aigarskadikis.github.io/blob/main/src/52.sql" target="_blank">https://github.com/aigarskadikis/aigarskadikis.github.io/blob/main/src/52.sql</a></p>
</div>
<input type="radio" name="tabs" id="54"><label for="54">54.sql</label><div class="tab">
Non-working external scripts<pre><code>SELECT hosts.host,items.key_,item_rtdata.error FROM items 
JOIN hosts ON (hosts.hostid=items.hostid) 
JOIN item_rtdata ON (items.itemid=item_rtdata.itemid) 
WHERE hosts.status=0 AND items.status=0 AND items.type=10 
AND LENGTH(item_rtdata.error) > 0;</code></pre>
Show items by proxy<pre><code>SELECT COUNT(*),proxy.host AS proxy,items.type 
FROM items 
JOIN hosts ON (items.hostid=hosts.hostid) 
JOIN hosts proxy ON (hosts.proxy_hostid=proxy.hostid) 
WHERE hosts.status = 0 
AND items.status = 0 
AND proxy.status IN (5,6) 
GROUP BY 2,3 
ORDER BY 2,3;</code></pre>
Items in use<pre><code>SELECT CASE items.type  
WHEN 0 THEN 'Zabbix agent'  
WHEN 1 THEN 'SNMPv1 agent'  
WHEN 2 THEN 'Zabbix trapper'  
WHEN 3 THEN 'Simple check'  
WHEN 4 THEN 'SNMPv2 agent'  
WHEN 5 THEN 'Zabbix internal'  
WHEN 6 THEN 'SNMPv3 agent'  
WHEN 7 THEN 'Zabbix agent (active) check'  
WHEN 8 THEN 'Aggregate'  
WHEN 9 THEN 'HTTP test (web monitoring scenario step)'  
WHEN 10 THEN 'External check'  
WHEN 11 THEN 'Database monitor'  
WHEN 12 THEN 'IPMI agent'  
WHEN 13 THEN 'SSH agent'  
WHEN 14 THEN 'TELNET agent'  
WHEN 15 THEN 'Calculated'  
WHEN 16 THEN 'JMX agent'  
WHEN 17 THEN 'SNMP trap'  
WHEN 18 THEN 'Dependent item'  
WHEN 19 THEN 'HTTP agent'  
WHEN 20 THEN 'SNMP agent'  
WHEN 21 THEN 'Script item'  
END AS type,COUNT(*)  
FROM items  
JOIN hosts ON (hosts.hostid=items.hostid)  
WHERE hosts.status=0  
AND items.status=0  
GROUP BY items.type  
ORDER BY COUNT(*) DESC;</code></pre>
Owner of LLD dependent item. What is interval for owner<pre><code>SELECT master_itemid.key_,master_itemid.delay,COUNT(*) FROM items 
JOIN hosts ON (hosts.hostid=items.hostid) 
JOIN items master_itemid ON (master_itemid.itemid=items.master_itemid) 
WHERE items.flags=1 AND hosts.status=0 AND items.status=0 AND master_itemid.status=0 AND items.type=18 
GROUP BY 1,2 ORDER BY 3 DESC;</code></pre>
Enabled and disabled LLD items, its key<pre><code>SELECT items.type,items.key_,items.delay,items.status,COUNT(*) FROM items 
JOIN hosts ON (hosts.hostid=items.hostid) WHERE items.flags=1 AND hosts.status=0 
GROUP BY 1,2,3,4 ORDER BY 1,2,3,4;</code></pre>
Which dashboard has been using host group id:2 for the input<pre><code>SELECT DISTINCT dashboard.name,hstgrp.name FROM widget_field 
JOIN widget ON (widget.widgetid=widget_field.widgetid) 
JOIN dashboard_page ON (dashboard_page.dashboard_pageid=widget.dashboard_pageid) 
JOIN dashboard ON (dashboard.dashboardid=dashboard_page.dashboardid) 
JOIN hstgrp ON (hstgrp.groupid=widget_field.value_groupid) 
WHERE widget_field.value_groupid IN (2);</code></pre>
Zabbix agent hitting the central server<pre><code>SELECT hosts.host AS proxy, 
CASE autoreg_host.flags 
WHEN 0 THEN 'IP address, do not update host interface' 
WHEN 1 THEN 'IP address, update default host interface' 
WHEN 2 THEN 'DNS name, update default host interface' 
END AS "connect using", 
CASE autoreg_host.tls_accepted 
WHEN 1 THEN 'Unencrypted' 
WHEN 2 THEN 'TLS with PSK' 
END AS "Encryption", 
COUNT(*) AS "amount of hosts" 
FROM autoreg_host 
JOIN hosts ON (hosts.hostid=autoreg_host.proxy_hostid) 
GROUP BY 1,2,3 ORDER BY 1,2,3;</code></pre>
PostgreSQL<pre><code>SELECT proxy.host AS proxy, hosts.host, ARRAY_TO_STRING(ARRAY_AGG(template.host),', ') AS templates FROM hosts JOIN hosts_templates ON (hosts_templates.hostid=hosts.hostid) LEFT JOIN hosts proxy ON (hosts.proxy_hostid=proxy.hostid) LEFT JOIN hosts template ON (hosts_templates.templateid=template.hostid) WHERE hosts.status IN (0,1) AND hosts.flags=0 GROUP BY 1,2 ORDER BY 1,3,2;</code></pre>
MySQL<pre><code>SELECT proxy.host AS proxy, hosts.host, GROUP_CONCAT(template.host SEPARATOR ', ') AS templates FROM hosts JOIN hosts_templates ON (hosts_templates.hostid=hosts.hostid) LEFT JOIN hosts proxy ON (hosts.proxy_hostid=proxy.hostid) LEFT JOIN hosts template ON (hosts_templates.templateid=template.hostid) WHERE hosts.status IN (0,1) AND hosts.flags=0 GROUP BY 1,2 ORDER BY 1,3,2;</code></pre>
For items which are currently disabled, clean the error message in database. This will help to locate what really is not working and why<pre><code>UPDATE item_rtdata SET error='' WHERE itemid IN ( 
SELECT items.itemid FROM item_rtdata, items, hosts 
WHERE item_rtdata.state=1 AND hosts.status=0 AND items.status=1 
AND item_rtdata.itemid=items.itemid 
AND hosts.hostid=items.hostid 
);</code></pre>
For items which are currently disabled, reset the state as supported. This will help to locate what really is not working and why. Item will remain disabled<pre><code>UPDATE item_rtdata SET state=0 WHERE itemid IN ( 
SELECT items.itemid FROM item_rtdata, items, hosts 
WHERE item_rtdata.state=1 AND hosts.status=0 AND items.status=1 
AND item_rtdata.itemid=items.itemid 
AND hosts.hostid=items.hostid 
);</code></pre>
Print error message for enabled hosts and enabled data collector items<pre><code>SELECT hosts.host, items.name, item_rtdata.error FROM item_rtdata, items, hosts 
WHERE item_rtdata.state=1 AND hosts.status=0 AND items.status=0 
AND item_rtdata.itemid=items.itemid 
AND hosts.hostid=items.hostid;</code></pre>
Identify item membership. Usefull if that is master item<pre><code>SELECT proxy.host AS proxy, hosts.host, items.name, items.key_, items.delay 
FROM hosts 
LEFT JOIN hosts proxy ON (hosts.proxy_hostid=proxy.hostid) 
JOIN items ON (items.hostid=hosts.hostid) 
WHERE items.itemid IN (12345,5678);</code></pre>
<p>Download this section: <a href="src/54.sql">https://aigarskadikis.github.io/src/54.sql</a><br />
Fancy syntax highlighter? Read same page on GitHub: <a href="https://github.com/aigarskadikis/aigarskadikis.github.io/blob/main/src/54.sql" target="_blank">https://github.com/aigarskadikis/aigarskadikis.github.io/blob/main/src/54.sql</a></p>
</div>
<input type="radio" name="tabs" id="60"><label for="60">60.sql</label><div class="tab">
Active problems, including Zabbix internal problems (item unsupported, trigger unsupported)<pre><code>SELECT COUNT(*),source,object,severity FROM problem GROUP BY 2,3,4 ORDER BY severity;</code></pre>
ZBX hosts unreachable<pre><code>SELECT proxy.host AS proxy, 
hosts.host, 
interface.error, 
CONCAT('zabbix.php?action=host.edit&hostid=',hosts.hostid) AS goTo 
FROM hosts 
LEFT JOIN hosts proxy ON (hosts.proxy_hostid=proxy.hostid) 
JOIN interface ON (interface.hostid=hosts.hostid) 
WHERE LENGTH(interface.error) > 0 
AND interface.type=1;</code></pre>
SNMP hosts unreachable<pre><code>SELECT proxy.host AS proxy, 
hosts.host, 
interface.error, 
CONCAT('zabbix.php?action=host.edit&hostid=',hosts.hostid) AS goTo 
FROM hosts 
LEFT JOIN hosts proxy ON (hosts.proxy_hostid=proxy.hostid) 
JOIN interface ON (interface.hostid=hosts.hostid) 
WHERE LENGTH(interface.error) > 0 
AND interface.type=2;</code></pre>
Non-working external scripts<pre><code>SELECT hosts.host,items.key_,item_rtdata.error FROM items 
JOIN hosts ON (hosts.hostid=items.hostid) 
JOIN item_rtdata ON (items.itemid=item_rtdata.itemid) 
WHERE hosts.status=0 AND items.status=0 AND items.type=10 
AND LENGTH(item_rtdata.error) > 0;</code></pre>
Check native HA heartbeat<pre><code>SELECT * FROM ha_node;</code></pre>
Show items by proxy<pre><code>SELECT COUNT(*),proxy.host AS proxy,items.type 
FROM items 
JOIN hosts ON (items.hostid=hosts.hostid) 
JOIN hosts proxy ON (hosts.proxy_hostid=proxy.hostid) 
WHERE hosts.status = 0 
AND items.status = 0 
AND proxy.status IN (5,6) 
GROUP BY 2,3 
ORDER BY 2,3;</code></pre>
Difference between installed macros between host VS template VS nested/child templates<pre><code>SELECT hm1.macro AS Macro, child.host AS owner, hm2.value AS defaultValue, parent.host AS OverrideInstalled, hm1.value AS OverrideValue FROM hosts parent, hosts child, hosts_templates rel, hostmacro hm1, hostmacro hm2 WHERE parent.hostid=rel.hostid AND child.hostid=rel.templateid AND hm1.hostid = parent.hostid AND hm2.hostid = child.hostid AND hm1.macro = hm2.macro AND parent.flags=0 AND child.flags=0 AND hm1.value <> hm2.value;</code></pre>
Detect if there is difference between template macro and host macro. This is surface level detection. it does not take care of values between nested templates<pre><code>SELECT b.host, 
hm2.macro, 
hm2.value AS templateValue, 
h.host, 
hm1.macro, 
hm1.value AS hostValue 
FROM hosts_templates, 
hosts h, 
hosts b, 
hostmacro hm1, 
hostmacro hm2, 
interface 
WHERE hosts_templates.hostid = h.hostid 
AND hosts_templates.templateid = b.hostid 
AND interface.hostid = h.hostid 
AND hm1.hostid = h.hostid 
AND hm2.hostid = hosts_templates.templateid 
AND hm1.macro = hm2.macro 
AND hm1.value <> hm2.value;</code></pre>
Items in use<pre><code>SELECT CASE items.type  
WHEN 0 THEN 'Zabbix agent'  
WHEN 1 THEN 'SNMPv1 agent'  
WHEN 2 THEN 'Zabbix trapper'  
WHEN 3 THEN 'Simple check'  
WHEN 4 THEN 'SNMPv2 agent'  
WHEN 5 THEN 'Zabbix internal'  
WHEN 6 THEN 'SNMPv3 agent'  
WHEN 7 THEN 'Zabbix agent (active) check'  
WHEN 8 THEN 'Aggregate'  
WHEN 9 THEN 'HTTP test (web monitoring scenario step)'  
WHEN 10 THEN 'External check'  
WHEN 11 THEN 'Database monitor'  
WHEN 12 THEN 'IPMI agent'  
WHEN 13 THEN 'SSH agent'  
WHEN 14 THEN 'TELNET agent'  
WHEN 15 THEN 'Calculated'  
WHEN 16 THEN 'JMX agent'  
WHEN 17 THEN 'SNMP trap'  
WHEN 18 THEN 'Dependent item'  
WHEN 19 THEN 'HTTP agent'  
WHEN 20 THEN 'SNMP agent'  
WHEN 21 THEN 'Script item'  
END AS type,COUNT(*)  
FROM items  
JOIN hosts ON (hosts.hostid=items.hostid)  
WHERE hosts.status=0  
AND items.status=0  
GROUP BY items.type  
ORDER BY COUNT(*) DESC;</code></pre>
All events closed by global correlation rule<pre><code>SELECT 
repercussion.clock, 
repercussion.name, 
rootCause.clock, 
rootCause.name 
FROM events repercussion 
JOIN event_recovery ON (event_recovery.eventid=repercussion.eventid) 
JOIN events rootCause ON (rootCause.eventid=event_recovery.c_eventid) 
WHERE event_recovery.c_eventid IS NOT NULL 
ORDER BY repercussion.clock ASC;</code></pre>
All active data collector items on enabled hosts<pre><code>SELECT 
hosts.host, 
items.name, 
items.type, 
items.key_, 
items.delay 
FROM items 
JOIN hosts ON (hosts.hostid=items.hostid) 
WHERE hosts.status=0 
AND items.status=0 
ORDER BY 1,2,3,4,5;</code></pre>
Owner of LLD dependent item. What is interval for owner<pre><code>SELECT master_itemid.key_,master_itemid.delay,COUNT(*) FROM items 
JOIN hosts ON (hosts.hostid=items.hostid) 
JOIN items master_itemid ON (master_itemid.itemid=items.master_itemid) 
WHERE items.flags=1 AND hosts.status=0 AND items.status=0 AND master_itemid.status=0 AND items.type=18 
GROUP BY 1,2 ORDER BY 3 DESC;</code></pre>
Enabled and disabled LLD items, its key<pre><code>SELECT items.type,items.key_,items.delay,items.status,COUNT(*) FROM items 
JOIN hosts ON (hosts.hostid=items.hostid) WHERE items.flags=1 AND hosts.status=0 
GROUP BY 1,2,3,4 ORDER BY 1,2,3,4;</code></pre>
Which dashboard has been using host group id:2 for the input<pre><code>SELECT DISTINCT dashboard.name,hstgrp.name FROM widget_field 
JOIN widget ON (widget.widgetid=widget_field.widgetid) 
JOIN dashboard_page ON (dashboard_page.dashboard_pageid=widget.dashboard_pageid) 
JOIN dashboard ON (dashboard.dashboardid=dashboard_page.dashboardid) 
JOIN hstgrp ON (hstgrp.groupid=widget_field.value_groupid) 
WHERE widget_field.value_groupid IN (2);</code></pre>
Zabbix agent hitting the central server<pre><code>SELECT hosts.host AS proxy, 
CASE autoreg_host.flags 
WHEN 0 THEN 'IP address, do not update host interface' 
WHEN 1 THEN 'IP address, update default host interface' 
WHEN 2 THEN 'DNS name, update default host interface' 
END AS "connect using", 
CASE autoreg_host.tls_accepted 
WHEN 1 THEN 'Unencrypted' 
WHEN 2 THEN 'TLS with PSK' 
END AS "Encryption", 
COUNT(*) AS "amount of hosts" 
FROM autoreg_host 
JOIN hosts ON (hosts.hostid=autoreg_host.proxy_hostid) 
GROUP BY 1,2,3 ORDER BY 1,2,3;</code></pre>
Items without a template<pre><code>SELECT hosts.host, items.key_ FROM items 
JOIN hosts ON (hosts.hostid=items.hostid) 
WHERE hosts.status=0 AND hosts.flags=0 
AND items.status=0 AND items.templateid IS NULL AND items.flags=0;</code></pre>
Hosts with multiple interfaces<pre><code>SELECT hosts.host FROM interface 
JOIN hosts ON (hosts.hostid=interface.hostid) 
WHERE hosts.flags=0 
GROUP BY hosts.host 
HAVING COUNT(interface.interfaceid) > 1;</code></pre>
PostgreSQL<pre><code>SELECT proxy.host AS proxy, hosts.host, ARRAY_TO_STRING(ARRAY_AGG(template.host),', ') AS templates FROM hosts JOIN hosts_templates ON (hosts_templates.hostid=hosts.hostid) LEFT JOIN hosts proxy ON (hosts.proxy_hostid=proxy.hostid) LEFT JOIN hosts template ON (hosts_templates.templateid=template.hostid) WHERE hosts.status IN (0,1) AND hosts.flags=0 GROUP BY 1,2 ORDER BY 1,3,2;</code></pre>
MySQL<pre><code>SELECT proxy.host AS proxy, hosts.host, GROUP_CONCAT(template.host SEPARATOR ', ') AS templates FROM hosts JOIN hosts_templates ON (hosts_templates.hostid=hosts.hostid) LEFT JOIN hosts proxy ON (hosts.proxy_hostid=proxy.hostid) LEFT JOIN hosts template ON (hosts_templates.templateid=template.hostid) WHERE hosts.status IN (0,1) AND hosts.flags=0 GROUP BY 1,2 ORDER BY 1,3,2;</code></pre>
Non-working LLD rules<pre><code>SELECT 
hosts.name AS hostName, 
items.key_ AS itemKey, 
problem.name AS LLDerror, 
CONCAT('host_discovery.php?form=update&itemid=',problem.objectid) AS goTo 
FROM problem 
JOIN items ON (items.itemid=problem.objectid) 
JOIN hosts ON (hosts.hostid=items.hostid) 
WHERE problem.source > 0 AND problem.object=5;</code></pre>
Non-working data collector items<pre><code>SELECT 
hosts.name AS hostName, 
items.key_ AS itemKey, 
problem.name AS DataCollectorError, 
CONCAT('items.php?form=update&itemid=',problem.objectid) AS goTo 
FROM problem 
JOIN items ON (items.itemid=problem.objectid) 
JOIN hosts ON (hosts.hostid=items.hostid) 
WHERE problem.source > 0 AND problem.object=4;</code></pre>
Trigger evaluation problems<pre><code>SELECT 
DISTINCT CONCAT('triggers.php?form=update&triggerid=',problem.objectid) AS goTo, 
hosts.name AS hostName, 
triggers.description AS triggerTitle, 
problem.name AS TriggerEvaluationError 
FROM problem 
JOIN triggers ON (triggers.triggerid=problem.objectid) 
JOIN functions ON (functions.triggerid=triggers.triggerid) 
JOIN items ON (items.itemid=functions.itemid) 
JOIN hosts ON (hosts.hostid=items.hostid) 
WHERE problem.source > 0 AND problem.object=0;</code></pre>
User sessions<pre><code>SELECT COUNT(*),users.username 
FROM sessions 
JOIN users ON (users.userid=sessions.userid) 
GROUP BY 2 ORDER BY 1 ASC;</code></pre>
Open problems<pre><code>SELECT COUNT(*) AS count, 
CASE 
WHEN source = 0 THEN 'surface' 
WHEN source > 0 THEN 'internal' 
END AS level, 
CASE 
WHEN source=0 AND object=0 THEN 'trigger in a problem state' 
WHEN source=3 AND object=0 THEN 'cannot evaluate trigger expression' 
WHEN source=3 AND object=4 THEN 'data collection not working' 
WHEN source=3 AND object=5 THEN 'low level discovery not perfect' 
END AS problemCategory 
FROM problem GROUP BY 2,3 
ORDER BY 2 DESC;</code></pre>
Item update frequency<pre><code>SELECT h2.host AS Source, 
i2.name AS itemName, 
i2.key_ AS itemKey, 
i2.delay AS OriginalUpdateFrequency, 
h1.host AS exceptionInstalledOn, 
i1.delay AS FrequencyChild, 
CASE 
WHEN i1.flags=1 THEN 'LLD rule' 
WHEN i1.flags IN (0,4) THEN 'data collection' 
END AS itemCategory, 
CASE 
WHEN i1.flags=1 THEN CONCAT('host_discovery.php?form=update&context=host&itemid=',i1.itemid) 
WHEN i1.flags IN (0,4) THEN CONCAT('items.php?form=update&context=host&hostid=',h1.hostid,'&itemid=',i1.itemid) 
END AS goTo 
FROM items i1 
JOIN items i2 ON (i2.itemid=i1.templateid) 
JOIN hosts h1 ON (h1.hostid=i1.hostid) 
JOIN hosts h2 ON (h2.hostid=i2.hostid) 
WHERE i1.delay <> i2.delay;</code></pre>
Which dashboard widgets are using wildcards<pre><code>SELECT value_str AS pattern, 
widget.name AS widgetName, 
dashboard.name AS dashboardName 
FROM widget_field, widget, dashboard_page, dashboard 
WHERE widget_field.value_str like '%*%' 
AND widget.widgetid=widget_field.widgetid 
AND dashboard_page.dashboard_pageid=widget.dashboard_pageid 
AND dashboard.dashboardid=dashboard_page.dashboard_pageid 
ORDER BY 3,2,1;</code></pre>
Remove user refresh overrides in user level<pre><code>DELETE FROM profiles WHERE idx='web.dashboard.widget.rf_rate';</code></pre>
Print all online users with rights group ID: 13<pre><code>SELECT users.username, CASE 
WHEN permission=0 THEN 'DENY' 
WHEN permission=2 THEN 'READ_ONLY' 
WHEN permission=3 THEN 'READ_WRITE' 
END AS permission, 
hstgrp.name 
FROM users, users_groups, sessions, usrgrp, rights, hstgrp 
WHERE sessions.status=0 
AND rights.groupid=13 
AND users.userid=users_groups.userid 
AND users.userid=sessions.userid 
AND users_groups.usrgrpid=usrgrp.usrgrpid 
AND users_groups.userid=users.userid 
AND usrgrp.usrgrpid=rights.groupid 
AND rights.id=hstgrp.groupid;</code></pre>
For items which are currently disabled, clean the error message in database. This will help to locate what really is not working and why<pre><code>UPDATE item_rtdata SET error='' WHERE itemid IN ( 
SELECT items.itemid FROM item_rtdata, items, hosts 
WHERE item_rtdata.state=1 AND hosts.status=0 AND items.status=1 
AND item_rtdata.itemid=items.itemid 
AND hosts.hostid=items.hostid 
);</code></pre>
For items which are currently disabled, reset the state as supported. This will help to locate what really is not working and why. Item will remain disabled<pre><code>UPDATE item_rtdata SET state=0 WHERE itemid IN ( 
SELECT items.itemid FROM item_rtdata, items, hosts 
WHERE item_rtdata.state=1 AND hosts.status=0 AND items.status=1 
AND item_rtdata.itemid=items.itemid 
AND hosts.hostid=items.hostid 
);</code></pre>
Print error message for enabled hosts and enabled data collector items<pre><code>SELECT hosts.host, items.name, item_rtdata.error FROM item_rtdata, items, hosts 
WHERE item_rtdata.state=1 AND hosts.status=0 AND items.status=0 
AND item_rtdata.itemid=items.itemid 
AND hosts.hostid=items.hostid;</code></pre>
Identify item membership. Usefull if that is master item<pre><code>SELECT proxy.host AS proxy, hosts.host, items.name, items.key_, items.delay 
FROM hosts 
LEFT JOIN hosts proxy ON (hosts.proxy_hostid=proxy.hostid) 
JOIN items ON (items.hostid=hosts.hostid) 
WHERE items.itemid IN (12345,5678);</code></pre>
<p>Download this section: <a href="src/60.sql">https://aigarskadikis.github.io/src/60.sql</a><br />
Fancy syntax highlighter? Read same page on GitHub: <a href="https://github.com/aigarskadikis/aigarskadikis.github.io/blob/main/src/60.sql" target="_blank">https://github.com/aigarskadikis/aigarskadikis.github.io/blob/main/src/60.sql</a></p>
</div>
<input type="radio" name="tabs" id="62"><label for="62">62.sql</label><div class="tab">
Active problems, including Zabbix internal problems (item unsupported, trigger unsupported)<pre><code>SELECT COUNT(*),source,object,severity FROM problem GROUP BY 2,3,4 ORDER BY severity;</code></pre>
Non-working external scripts<pre><code>SELECT hosts.host,items.key_,item_rtdata.error FROM items 
JOIN hosts ON (hosts.hostid=items.hostid) 
JOIN item_rtdata ON (items.itemid=item_rtdata.itemid) 
WHERE hosts.status=0 AND items.status=0 AND items.type=10 
AND LENGTH(item_rtdata.error) > 0;</code></pre>
Check native HA heartbeat<pre><code>SELECT * FROM ha_node;</code></pre>
Show items by proxy<pre><code>SELECT COUNT(*),proxy.host AS proxy,items.type 
FROM items 
JOIN hosts ON (items.hostid=hosts.hostid) 
JOIN hosts proxy ON (hosts.proxy_hostid=proxy.hostid) 
WHERE hosts.status = 0 
AND items.status = 0 
AND proxy.status IN (5,6) 
GROUP BY 2,3 
ORDER BY 2,3;</code></pre>
Items in use<pre><code>SELECT CASE items.type  
WHEN 0 THEN 'Zabbix agent'  
WHEN 1 THEN 'SNMPv1 agent'  
WHEN 2 THEN 'Zabbix trapper'  
WHEN 3 THEN 'Simple check'  
WHEN 4 THEN 'SNMPv2 agent'  
WHEN 5 THEN 'Zabbix internal'  
WHEN 6 THEN 'SNMPv3 agent'  
WHEN 7 THEN 'Zabbix agent (active) check'  
WHEN 8 THEN 'Aggregate'  
WHEN 9 THEN 'HTTP test (web monitoring scenario step)'  
WHEN 10 THEN 'External check'  
WHEN 11 THEN 'Database monitor'  
WHEN 12 THEN 'IPMI agent'  
WHEN 13 THEN 'SSH agent'  
WHEN 14 THEN 'TELNET agent'  
WHEN 15 THEN 'Calculated'  
WHEN 16 THEN 'JMX agent'  
WHEN 17 THEN 'SNMP trap'  
WHEN 18 THEN 'Dependent item'  
WHEN 19 THEN 'HTTP agent'  
WHEN 20 THEN 'SNMP agent'  
WHEN 21 THEN 'Script item'  
END AS type,COUNT(*)  
FROM items  
JOIN hosts ON (hosts.hostid=items.hostid)  
WHERE hosts.status=0  
AND items.status=0  
GROUP BY items.type  
ORDER BY COUNT(*) DESC;</code></pre>
Owner of LLD dependent item. What is interval for owner<pre><code>SELECT master_itemid.key_,master_itemid.delay,COUNT(*) FROM items 
JOIN hosts ON (hosts.hostid=items.hostid) 
JOIN items master_itemid ON (master_itemid.itemid=items.master_itemid) 
WHERE items.flags=1 AND hosts.status=0 AND items.status=0 AND master_itemid.status=0 AND items.type=18 
GROUP BY 1,2 ORDER BY 3 DESC;</code></pre>
Frequency of LLD rule for enabled hosts and enabled items discoveries for only monitored hosts<pre><code>SELECT type,delay,COUNT(*) FROM items 
JOIN hosts ON (hosts.hostid=items.hostid) 
WHERE items.flags=1 AND hosts.status=0 AND items.status=0 
GROUP BY 1,2 ORDER BY 1,2;</code></pre>
Host behind proxy 'z62prx' where interface is not healthy. Host is down<pre><code>SELECT hosts.host, interface.error 
FROM interface 
JOIN hosts ON (hosts.hostid=interface.hostid) 
LEFT JOIN hosts proxy ON (hosts.proxy_hostid=proxy.hostid) 
WHERE interface.available=2 AND hosts.status=0 AND proxy.host='z62prx';</code></pre>
Host/interface errors per all hosts behind proxy<pre><code>SELECT proxy.host, hosts.host, interface.error 
FROM interface 
JOIN hosts ON (hosts.hostid=interface.hostid) 
LEFT JOIN hosts proxy ON (hosts.proxy_hostid=proxy.hostid) 
WHERE interface.available=2 AND proxy.host IS NOT NULL 
ORDER BY 1,2,3;</code></pre>
For items which are currently disabled, clean the error message in database. This will help to locate what really is not working and why<pre><code>UPDATE item_rtdata SET error='' WHERE itemid IN ( 
SELECT items.itemid FROM item_rtdata, items, hosts 
WHERE item_rtdata.state=1 AND hosts.status=0 AND items.status=1 
AND item_rtdata.itemid=items.itemid 
AND hosts.hostid=items.hostid 
);</code></pre>
For items which are currently disabled, reset the state as supported. This will help to locate what really is not working and why. Item will remain disabled<pre><code>UPDATE item_rtdata SET state=0 WHERE itemid IN ( 
SELECT items.itemid FROM item_rtdata, items, hosts 
WHERE item_rtdata.state=1 AND hosts.status=0 AND items.status=1 
AND item_rtdata.itemid=items.itemid 
AND hosts.hostid=items.hostid 
);</code></pre>
Print error message for enabled hosts and enabled data collector items<pre><code>SELECT hosts.host, items.name, item_rtdata.error FROM item_rtdata, items, hosts 
WHERE item_rtdata.state=1 AND hosts.status=0 AND items.status=0 
AND item_rtdata.itemid=items.itemid 
AND hosts.hostid=items.hostid;</code></pre>
<p>Download this section: <a href="src/62.sql">https://aigarskadikis.github.io/src/62.sql</a><br />
Fancy syntax highlighter? Read same page on GitHub: <a href="https://github.com/aigarskadikis/aigarskadikis.github.io/blob/main/src/62.sql" target="_blank">https://github.com/aigarskadikis/aigarskadikis.github.io/blob/main/src/62.sql</a></p>
</div>
</div><div id='searchInputArea'><span>SEARCH</span><input type='text' id='searchInput' placeholder='Type at least 1 characters...' onkeyup='onTypeSearchInput(event)' /></div><div id='searchResultDlg'><div id='closeIcon' onclick='onCloseDlg()'>&times;</div><div id='searchResultDlgContent'></div></div><script src='searcher.js'></script></body></html>
