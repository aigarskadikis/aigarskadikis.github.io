<html><head><style type='text/css'>
.tabs{display:flex;flex-wrap:wrap;width:100%}.tabs label{order:1;display:flex;justify-content:center;align-items:center;padding:.1rem .5rem;margin:0;cursor:pointer}.tabs .tab{order:9;flex-grow:1;width:100%;height:100rem;display:none;background:#fff;padding:.4rem}.tabs input[type="radio"]{display:none}.tabs input[type="radio"]:checked + label{background:#fff}.tabs input[type="radio"]:checked + label + .tab{display:block}body{background:#dcdcdc;min-height:100vh;box-sizing:border-box;font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen,Ubuntu,Fira Sans,Droid Sans,Helvetica Neue,sans-serif;font-weight:300;line-height:1.5;font-size:100%;display:flex}pre{padding:0;margin:0 0 1em}
</style></head><body><div class='tabs'>
<input type="radio" name="tabs" id="backup" checked="checked"><label for="backup">backup</label><div class="tab">
Backup directories which can be related to Zabbix<pre><code>cd /usr/share/zabbix && mkdir -p ~/backup${PWD} && cp -a * ~/backup${PWD}
cd /etc/zabbix && mkdir -p ~/backup${PWD} && cp -a * ~/backup${PWD}
cd /usr/lib/zabbix && mkdir -p ~/backup${PWD} && cp -a * ~/backup${PWD}
cd /etc/cron.d && mkdir -p ~/backup${PWD} && cp -a * ~/backup${PWD}
cd /usr/local/bin && mkdir -p ~/backup${PWD} && cp -a * ~/backup${PWD}
cd /etc/nginx/conf.d && mkdir -p ~/backup${PWD} && cp -a * ~/backup${PWD}
cd /etc/php-fpm.d && mkdir -p ~/backup${PWD} && cp -a * ~/backup${PWD}</code></pre>
30 days configuration backup if MySQL 8<pre><code>BACKUP_DIR=/home/zabbix/backup
mkdir -p "$BACKUP_DIR"
mysqldump --defaults-file=/etc/zabbix/zabbix_backup.cnf --flush-logs --single-transaction --no-tablespaces --set-gtid-purged=OFF --ignore-table=zabbix.history --ignore-table=zabbix.history_log --ignore-table=zabbix.history_str --ignore-table=zabbix.history_text --ignore-table=zabbix.history_uint --ignore-table=zabbix.trends --ignore-table=zabbix.trends_uint zabbix > "$BACKUP_DIR/backup.sql" && gzip --best "$BACKUP_DIR/backup.sql" && mv "$BACKUP_DIR/backup.sql.gz" "$BACKUP_DIR/quick.restore.$(date +%Y%m%d.%H%M).sql.gz"
find /home/zabbix/backup -type f -mtime +30
find /home/zabbix/backup -type f -mtime +30 -delete</code></pre>
Backup and compress zabbix server config with a purpose to restore it on other machine<pre><code>tar --create --verbose --use-compress-program='gzip -9' /etc/zabbix/zabbix_server.conf | base64 -w0 | sed 's|^|cd / \&\& echo "|' | sed 's%$%" | base64 --decode | gunzip | tar -xv%' && echo</code></pre>
Backup and compress Zabbix agent 2 config with a purpose to restore it on other machine<pre><code>tar --create --verbose --use-compress-program='gzip -9' /etc/zabbix/zabbix_agent2.conf | base64 -w0 | sed 's|^|cd / \&\& echo "|' | sed 's%$%" | base64 --decode | gunzip | tar -xv%' && echo</code></pre>
Backup and compress partitioning script and configuration files<pre><code>tar --create --verbose --use-compress-program='gzip -9' /etc/zabbix/zabbix_partitioning.conf /usr/local/bin/zabbix_partitioning.py /etc/cron.d/zabbix_partitioning | base64 -w0 | sed 's|^|cd / \&\& echo "|' | sed 's%$%" | base64 --decode | gunzip | tar -xv%' && echo</code></pre>
Backup all frontend modules with 'xz' compression<pre><code>tar --create --verbose --use-compress-program='xz -9' /usr/share/zabbix/modules | base64 -w0 | sed 's|^|cd / \&\& echo "|' | sed 's%$%" | base64 --decode | unxz | tar -xv%' && echo</code></pre>
<p>Download this section: <a href="src/backup.sh">https://aigarskadikis.github.io/src/backup.sh</a><br />
Fancy syntax highlighter? Read same page on GitHub: <a href="https://github.com/aigarskadikis/aigarskadikis.github.io/blob/main/src/backup.sh" target="_blank">https://github.com/aigarskadikis/aigarskadikis.github.io/blob/main/src/backup.sh</a></p>
</div>
<input type="radio" name="tabs" id="el8"><label for="el8">el8</label><div class="tab">
Zabbix 6.0 LTS repository<pre><code>rpm -Uvh https://repo.zabbix.com/zabbix/6.0/rhel/8/x86_64/zabbix-release-6.0-2.el8.noarch.rpm</code></pre>
Familiar utilities<pre><code>dnf -y install strace vim tmux jq zabbix-get zabbix-sender zabbix-js</code></pre>
SNMP trap dependencies. Snmptrap (net-snmp-utils), snmpwalk (net-snmp-utils), snmptrapd (net-snmp), dependencies for zabbix_trap_receiver.pl (net-snmp-perl)<pre><code>dnf -y install net-snmp-utils net-snmp-perl net-snmp</code></pre>
Python 3 with YAML and MySQL connector support<pre><code>dnf -y install python3 python3-PyMySQL python3-PyYAML</code></pre>
Install MySQL server on Oracle Linux 8, RHEL 8, Rocky Linux 8<pre><code>dnf -y install mysql-server</code></pre>
Work with Zabbix source<pre><code>dnf -y install git automake gcc</code></pre>
<p>Download this section: <a href="src/el8.sh">https://aigarskadikis.github.io/src/el8.sh</a><br />
Fancy syntax highlighter? Read same page on GitHub: <a href="https://github.com/aigarskadikis/aigarskadikis.github.io/blob/main/src/el8.sh" target="_blank">https://github.com/aigarskadikis/aigarskadikis.github.io/blob/main/src/el8.sh</a></p>
</div>
<input type="radio" name="tabs" id="get"><label for="get">get</label><div class="tab">
MySQL monitoring through Zabbix agent 2<pre><code>zabbix_get -s 127.0.0.1 -k 'mysql.get_status_variables["tcp://127.0.0.1:3306","zbx_monitor","zabbix"]'</code></pre>
PostgreSQL monitoring through Zabbix agent 2<pre><code>zabbix_get -s 127.0.0.1 -k 'pgsql.dbstat["tcp://127.0.0.1:5432","zbx_monitor","zabbix"]'</code></pre>
Oracle 19c monitoring through Zabbix agent 2<pre><code>zabbix_get -s 127.0.0.1 -k 'oracle.instance.info["tcp://127.0.0.1:1521","zabbix_mon","zabbix","ORCLPDB1"]'</code></pre>
<p>Download this section: <a href="src/get.sh">https://aigarskadikis.github.io/src/get.sh</a><br />
Fancy syntax highlighter? Read same page on GitHub: <a href="https://github.com/aigarskadikis/aigarskadikis.github.io/blob/main/src/get.sh" target="_blank">https://github.com/aigarskadikis/aigarskadikis.github.io/blob/main/src/get.sh</a></p>
</div>
<input type="radio" name="tabs" id="grep"><label for="grep">grep</label><div class="tab">
Check if master processes is runnign from server, proxy or agent<pre><code>ps auxww | grep "[z]abbix.*conf"</code></pre>
How long takes one configuration synchronization cycle. Command suitable for "zabbix_server" and "zabbix_proxy"<pre><code>ps auxww | grep "[c]onfiguration.*synced"</code></pre>
Zabbix server configuration file<pre><code>grep -v "^$\|#" /etc/zabbix/zabbix_server.conf | sort</code></pre>
Observe credentials how zabbix-server-mysql connects to database<pre><code>grep ^DB /etc/zabbix/zabbix_server.conf
grep "DB\|Include" /etc/zabbix/zabbix_server.conf | grep -v '#'</code></pre>
"trapper" processes of zabbix_server or zabbix_proxy<pre><code>ps auxww | grep '[:] trapper'</code></pre>
"history syncer" of zabbix_server or zabbix_proxy<pre><code>ps auxww | grep '[:] history syncer'</code></pre>
All restarts. Gracefull restarts<pre><code>grep "Starting Zabbix Server\|Zabbix Server stopped" /var/log/zabbix/zabbix_server.log
zcat /var/log/zabbix/zabbix_server*gz | grep "Starting Zabbix Server\|Zabbix Server stopped"</code></pre>
Check slow queries<pre><code>grep "slow query" /var/log/zabbix/zabbix_server.log</code></pre>
Differences between backend nodes<pre><code>grep -r '=' /etc/zabbix/zabbix_server.d/*</code></pre>
How much time take for housekeeper process to complete<pre><code>grep housekeeper /var/log/zabbix/zabbix_server.log</code></pre>
<p>Download this section: <a href="src/grep.sh">https://aigarskadikis.github.io/src/grep.sh</a><br />
Fancy syntax highlighter? Read same page on GitHub: <a href="https://github.com/aigarskadikis/aigarskadikis.github.io/blob/main/src/grep.sh" target="_blank">https://github.com/aigarskadikis/aigarskadikis.github.io/blob/main/src/grep.sh</a></p>
</div>
<input type="radio" name="tabs" id="loop"><label for="loop">loop</label><div class="tab">
Rotate between values<pre><code>echo "
one
two
" | grep -v "^$" | while IFS= read -r LINE
do {
echo $LINE
} done</code></pre>
<p>Download this section: <a href="src/loop.sh">https://aigarskadikis.github.io/src/loop.sh</a><br />
Fancy syntax highlighter? Read same page on GitHub: <a href="https://github.com/aigarskadikis/aigarskadikis.github.io/blob/main/src/loop.sh" target="_blank">https://github.com/aigarskadikis/aigarskadikis.github.io/blob/main/src/loop.sh</a></p>
</div>
<input type="radio" name="tabs" id="my"><label for="my">my</label><div class="tab">
List of MySQL tables/partitions by size<pre><code>du -ab /var/lib/mysql > /tmp/size.of.tables.txt
du -ah /var/lib/mysql > /tmp/size.of.tables.human.readable.txt</code></pre>
Backup data directory. Fastest way time-wise<pre><code>systemctl stop mysqld
tar --create --verbose --use-compress-program='gzip --fast' --file=/tmp/var.lib.mysql.tar.gz /var/lib/mysql</code></pre>
Authorize in MySQL<pre><code>mysql --host=127.0.0.1 --database=zabbixDB --user=zbx_srv --password='zabbix' --port=3306</code></pre>
Track how DB table partitions grow<pre><code>cd /var/lib/mysql/zabbix && watch -n1 'ls -Rltr | tail -10'</code></pre>
List of open files per MySQL server. If tables has a lot of partitions it will be a lot of files<pre><code>lsof -p $(pidof mysqld) > /tmp/mysqld.list.open.files.txt</code></pre>
How much data is generated in 24h<pre><code>du -lah /var/lib/mysql/zabbix | grep "$(date --date='2 days ago' '+p%Y_%m_%d')"
du -lah /var/lib/mysql/zabbix | grep "$(date --date='2 days ago' '+p%Y%m%d0000')"</code></pre>
Track progress of "OPTIMIZE TABLE" in MySQL<pre><code>watch -n1 "ls -Rltr /var/lib/mysql/zabbix | grep '#sql'"</code></pre>
Schema backup for MySQL 8. Useful for scripts<pre><code>mysqldump --defaults-file=/root/.my.cnf --flush-logs --single-transaction --set-gtid-purged=OFF --create-options --no-data zabbix | gzip --fast > schema.sql.gz</code></pre>
Create backup with a purpose to set up master to master replication<pre><code>mysqldump --source-data --all-databases --set-gtid-purged=OFF --ignore-table=zabbix.history --ignore-table=zabbix.history_uint --ignore-table=zabbix.history_str --ignore-table=zabbix.history_text --ignore-table=zabbix.history_log --ignore-table=zabbix.trends --ignore-table=zabbix.trends_uint | gzip --fast > /tmp/backup.sql.gz
chmod 777 /tmp/backup.sql.gz</code></pre>
Schema dump for historical tables only. Backup schema for 7 historical tables. usefull if need to repair replication as fast as possible<pre><code>mysqldump --set-gtid-purged=OFF --no-data zabbix history history_uint history_str history_log history_text trends trends_uint > empty.data.tables.with.partitions.sql</code></pre>
Data backup with gz compression<pre><code>mysqldump --defaults-file=/root/.my.cnf --set-gtid-purged=OFF --flush-logs --single-transaction --no-create-info --ignore-table=zabbix.history --ignore-table=zabbix.history_log --ignore-table=zabbix.history_str --ignore-table=zabbix.history_text --ignore-table=zabbix.history_uint --ignore-table=zabbix.trends --ignore-table=zabbix.trends_uint zabbix > data.sql && gzip data.sql</code></pre>
Data backup with xz compression<pre><code>mysqldump --defaults-file=/root/.my.cnf --set-gtid-purged=OFF --flush-logs --single-transaction --no-create-info --ignore-table=zabbix.history --ignore-table=zabbix.history_log --ignore-table=zabbix.history_str --ignore-table=zabbix.history_text --ignore-table=zabbix.history_uint --ignore-table=zabbix.trends --ignore-table=zabbix.trends_uint zabbix > data.sql && xz data.sql</code></pre>
Passwordless access for read-only user<pre><code>cd && cat << 'EOF' > .my.cnf
[client]
host=192.168.88.101
user=zbx_ro
password=passwd_ro_zbx
EOF</code></pre>
On-the-fly configuration backup. Check if this is not the node holding the Virtaul IP address. Do a backup on slave<pre><code>ip a | grep "192.168.88.55" || mysqldump --defaults-file=/root/.my.cnf --set-gtid-purged=OFF --flush-logs --single-transaction --ignore-table=zabbix.history --ignore-table=zabbix.history_log --ignore-table=zabbix.history_str --ignore-table=zabbix.history_text --ignore-table=zabbix.history_uint --ignore-table=zabbix.trends --ignore-table=zabbix.trends_uint zabbix | gzip > quick.restore.sql.gz</code></pre>
Schema backup for MySQL 8. Credentials embeded in command<pre><code>mysqldump --host=127.0.0.1 --user=root --password='zabbix' --set-gtid-purged=OFF --flush-logs --single-transaction --create-options --no-data zabbix | gzip --fast > schema.sql.gz</code></pre>
<p>Download this section: <a href="src/my.sh">https://aigarskadikis.github.io/src/my.sh</a><br />
Fancy syntax highlighter? Read same page on GitHub: <a href="https://github.com/aigarskadikis/aigarskadikis.github.io/blob/main/src/my.sh" target="_blank">https://github.com/aigarskadikis/aigarskadikis.github.io/blob/main/src/my.sh</a></p>
</div>
<input type="radio" name="tabs" id="sed"><label for="sed">sed</label><div class="tab">
Reinstall values which have been already customized<pre><code>sed -i 's|^CacheUpdateFrequency=.*|CacheUpdateFrequency=120|' /etc/zabbix/zabbix_server.conf && grep ^CacheUpdateFrequency /etc/zabbix/zabbix_server.conf
sed -i 's|^ValueCacheSize=.*|ValueCacheSize=768M|' /etc/zabbix/zabbix_server.conf && grep ^ValueCacheSize /etc/zabbix/zabbix_server.conf
sed -i 's|^TrendCacheSize=.*|TrendCacheSize=256M|' /etc/zabbix/zabbix_server.conf && grep ^TrendCacheSize /etc/zabbix/zabbix_server.conf
sed -i 's|^StartDiscoverers=.*|StartDiscoverers=20|' /etc/zabbix/zabbix_server.conf && grep ^StartDiscoverers /etc/zabbix/zabbix_server.conf</code></pre>
Summarize configuration file<pre><code>grep -v "^$\|#" /etc/zabbix/zabbix_server.conf | sort</code></pre>
Restart and follow log<pre><code>systemctl restart zabbix-server && tail -f /var/log/zabbix/zabbix_server.log</code></pre>
<p>Download this section: <a href="src/sed.sh">https://aigarskadikis.github.io/src/sed.sh</a><br />
Fancy syntax highlighter? Read same page on GitHub: <a href="https://github.com/aigarskadikis/aigarskadikis.github.io/blob/main/src/sed.sh" target="_blank">https://github.com/aigarskadikis/aigarskadikis.github.io/blob/main/src/sed.sh</a></p>
</div>
<input type="radio" name="tabs" id="sql2tsv"><label for="sql2tsv">sql2tsv</label><div class="tab">
MySQL<pre><code>echo "SELECT alias,
attempt_failed,
attempt_ip,
FROM_UNIXTIME(attempt_clock)
FROM users" | mysql --host='127.0.0.1' --user='zbx_web' --password='zabbix' --database='zabbix' --silent --skip-column-names --batch > /tmp/queue.tsv</code></pre>
<p>Download this section: <a href="src/sql2tsv.sh">https://aigarskadikis.github.io/src/sql2tsv.sh</a><br />
Fancy syntax highlighter? Read same page on GitHub: <a href="https://github.com/aigarskadikis/aigarskadikis.github.io/blob/main/src/sql2tsv.sh" target="_blank">https://github.com/aigarskadikis/aigarskadikis.github.io/blob/main/src/sql2tsv.sh</a></p>
</div>
<input type="radio" name="tabs" id="sudoers"><label for="sudoers">sudoers</label><div class="tab">
Allow to reload cache from Zabbix frontend<pre><code>cd /etc/sudoers.d
echo 'zabbix ALL=(ALL) NOPASSWD: /usr/sbin/zabbix_server -R config_cache_reload' | sudo tee zabbix_server_config_cache_reload
chmod 0440 zabbix_server_config_cache_reload</code></pre>
<p>Download this section: <a href="src/sudoers.sh">https://aigarskadikis.github.io/src/sudoers.sh</a><br />
Fancy syntax highlighter? Read same page on GitHub: <a href="https://github.com/aigarskadikis/aigarskadikis.github.io/blob/main/src/sudoers.sh" target="_blank">https://github.com/aigarskadikis/aigarskadikis.github.io/blob/main/src/sudoers.sh</a></p>
</div>
<input type="radio" name="tabs" id="supply"><label for="supply">supply</label><div class="tab">
Listening TCP ports<pre><code>ss --tcp --listen --numeric</code></pre>
Listening TCP ports with process identification<pre><code>ss --tcp --listen --numeric --process</code></pre>
Check if tcp port listens. Make sure it really listens on destination server before checking<pre><code>nc -v servername 3306</code></pre>
Check if port is open without external tools. If it reports 0, the port is reachable and in the listening state<pre><code>{ echo >/dev/tcp/127.0.0.1/3306 ; } 2>/dev/null; echo $?</code></pre>
Capture all SNMP traps traffic<pre><code>tcpdump -i any udp dst port 162 >> /var/log/zabbix/zabbix_traps.tcpdump</code></pre>
Activity for each block device, pretty-print  device  names, report task creation and system switching activity.<pre><code>sar -d -p -w 1</code></pre>
10 seconds of disk usage<pre><code>sar -d -wp 1 10 >> /tmp/disk.activity.txt</code></pre>
Installed packages on EL7 or EL8 system<pre><code>rpm -qa > /tmp/installed.packages.txt</code></pre>
Installed packages on Ubuntu/Debian<pre><code>apt list --installed > /tmp/apt.installed.txt</code></pre>
OS information<pre><code>cat /etc/*release* /tmp/os.info.txt</code></pre>
Disk space<pre><code>df -h > /tmp/disk.space.txt</code></pre>
Memory<pre><code>cat /proc/meminfo > /tmp/memory.txt
free -h >> /tmp/memory.txt</code></pre>
Usage of swap:<pre><code>for file in /proc/*/status ; do awk '/VmSwap|Name/{printf $2 " " $3}END{ print ""}' $file; done >> /tmp/swap.usage.txt</code></pre>
CPU information<pre><code>cat /proc/cpuinfo > /tmp/cpu.txt</code></pre>
Process list. Top memory. top CPU<pre><code>ps auxww > /tmp/process.list.txt
ps auxww --sort -%mem > /tmp/top.mem.processes.txt
ps auxww --sort -%cpu > /tmp/top.cpu.processes.txt</code></pre>
Shared memory segments and semaphore arrays<pre><code>ipcs -a > /tmp/shared.memory.segments.and.semaphore.arrays.txt</code></pre>
Last 1 million lines from messages<pre><code>tail -1000000 /var/log/messages > /tmp/messages.txt</code></pre>
Display all messages from the kernel ring buffer<pre><code>dmesg > /tmp/dmesg.txt</code></pre>
Live kernel settings<pre><code>sysctl -a > /tmp/.live.kernel.settings.txt</code></pre>
Last 1 million lines from /var/log/zabbix/zabbix_proxy.log<pre><code>tail -1000000 /var/log/zabbix/zabbix_proxy.log | gzip --best > /tmp/zabbix_proxy.$(date +%Y%m%d.%H%M).log.gz</code></pre>
Last 1 million lines from /var/log/zabbix/zabbix_server.log<pre><code>tail -1000000 /var/log/zabbix/zabbix_server.log | gzip --best > /tmp/zabbix_server.$(date +%Y%m%d.%H%M).log.gz</code></pre>
Service not booting up<pre><code>journalctl -u sshd | tail -100 > /tmp/sshd.txt</code></pre>
List of open files:<pre><code>lsof > /tmp/list.open.files.txt</code></pre>
Disk long term throughput, how fast we can create 64GB file<pre><code>time dd if=/dev/urandom of=/var/lib/mysql/64GB.file bs=1M count=65536 oflag=direct</code></pre>
<p>Download this section: <a href="src/supply.sh">https://aigarskadikis.github.io/src/supply.sh</a><br />
Fancy syntax highlighter? Read same page on GitHub: <a href="https://github.com/aigarskadikis/aigarskadikis.github.io/blob/main/src/supply.sh" target="_blank">https://github.com/aigarskadikis/aigarskadikis.github.io/blob/main/src/supply.sh</a></p>
</div>
<input type="radio" name="tabs" id="web"><label for="web">web</label><div class="tab">
Zabbix 6.0 frontend module to hide "Templates" column under "Configuration" => "Hosts"<pre><code>cd / && echo "/Td6WFoAAATm1rRGAgAhARwAAAAQz1jM4Cf/BIhdADqcyosJxdxJssUvYbZwczCa4NL6WKTOtRi0c554WcmBrkKJ0mJAeAaic7i991X+PJKgUTuAnCLyHef+BXOL1bHqkaZZZr4lBVY4be1LihI2ek87Yq0PoxsOmTJvtFLvNkQuXDQEwdAqs4FwSYnDJRsbo8LnCmjlRabqLk15axqJS9ccv9L4lAHtEWnvKA66Boc2njRgpyJXQUNhKfStLJlmV1gwGUBCH0Iq6bgCAp1B4hCtc7Xc6RdYDfBSEweI7oB7vSaq0PZhm3+Q7MJmw5HO4MGcUZpmeSHcvVQfnaX0AXb7OHtl6QkKs4YOdjqEDxrJ0AlQcs5ikDS8FfVYQPnVXYN0T92UMgNY+24lnNDq5fDw9yOHKvpoOM4hARy3RgSzD3rL+VHGtL5yXmORxrYWGBD0PooiX8hKTPnoQop47TmDrrShiQjSNcio30nj0Tti/MtDClNlSEaboMa1EGjcnNH7Ga4btSeGvbeY3hqTym4HHoU6JFldBtIEPFvCL1SHxSkVL8CBPapJCgmiev1aPK5VGl46hocWHfZ0GSRSf61ykDoITplZ2XU+j6/Vz4zkLh6iLeDV2ts1al+9SiL7fB2kT8LQAD7yOBAsIUzhQ2k5WH6Aa4q6XwDHfK+d63IcsYgKJoNP7qGySE9HrOcYeoWbtymprkltzXAbuRFEZqNxeqBXLPt1DM3Bd+F/QyQrDEA/nsxg+EJ6sLcnFnLDrlYxjSCxkh8KFZZHn1arIz/n1A+4yBOkE8f1f/BidwtLBOGAb7L0ngnm6VtlEw7EApeSPUvahjZXDPf9pfZSbyuLWfb9twZmEzCEa3tUvrLEa6FDibEQtzXmDNEWJIg4NIlw+MW56igfQ0c3pkxo/l78UpL+VborSVzdI46H3IKxY6bF7t9bk6IMiikie60tZbQGxeYVrxYmKdc7FXI8MehxOkOAP7+xL4XgFYCed1vfhxu3/FAKlgiA0ITGTUzXJa+bzEs4tyWPligj3KL1tUaH9UqxDgT8uH99O9jMduja1ZaR6WadsisLXgZ3XNgGwYfbtNZfXqk6ggfOjJCLznozMugf1NiDGUVVIIRCV6esaCrcDRVU06YlOY9SmJsFuC8fApi3ul8qljMMoZHonjshOc03QmaC75XmX26xloDmK8ygeiLGzO4MWHd1REQlhavsxADSLcNM5K/riurHH4+H7MvMMrwlk7e/H6dIiQJQxSzw2kSpprUM70jwoQKRgbthQdWIGyjRmf7BOzs9gdgJ4QVqSAkhvfWIFRTLZVjvpxURMqL2Rp5X4ankwEyAhbvx0mAlWLDv2jpB3MBdBwQbIwODrTZCGPKlBcax+azw5MmGGWFEK0UMeW2w0BvJpjTP6504r/NuKU9SRlZCHC9oykwCT23x1teLxQFo3EGkdVE+AGolBqi3OxNtdUJNMvpbR3La/JetE3JGzjUVp36bwnHcddVKJhmSdeKgIXcwVJWJ+8vCeg2A9EKocxq1QMJliVymitvrnLAxBX21VYmRtto/E00MeOzrQoqoI5RHs832OyUAAPnXuYqgJ3MuAAGkCYBQAADffS3NscRn+wIAAAAABFla" | base64 --decode | unxz | tar -xv</code></pre>
On EL8 system allow NGINX to server Zabbix GUI under 127.0.0.1:80. This is useful for Zabbix API<pre><code>cd / && echo "H4sIANj39GICA+2VQU/iQBTHOfMpeuCAMdspbEGzxANRVk0UXKgHIzqp7RQmlpnuzNQFF/3sO61QQbDVi8km70fCZDLv/3/T6XtTojzERpRNkcdZYPporFRk1up7pqV/NTPgwnx07+7o1HQjaiZBpc9iaZq2lY6at+P3ZrNRqtn1vUbNbjRsu2TVrbrdLBlW6QuIpXKFYZQE5yovrmj9P0US8UCE8bdsLAipVIQZGftWK1t7CcbMnZB0npVJq1zOgpKDSkYUS4Hk2BUEvRRQ6zWGMp9Ml6MZjaOVtZB7rqKcGQcGCtwHqkvO1H8rW3yNHGHGFQ54zHw950HwutenLY5oi4kSMxzQkMjFvBILmv4h48C27AJDV0qi5BZb1/OIlFhv8WW+trclZBpRkWXW52n5+fmeDTQ0x2pLPp+w2Vr+MCy0quqOHqJ50tPXt0PzZk6ZF8Y+mSdBIdn5bJqsAoiKxUoJFR/jA2E+F1+W79m4vkU3w6Twqmhe2faggSuVN6I40m84mceMTn8gETOkRd+CaLIoalNy7771rlxGIVXaRI0xZQE3bqvmbpp3p4rM3Z3K+8q8FtncpHAnen7UO7w873Qd3O/1nO0tWGQxOOyfXjj45+lZp9s+72xaVLJH8wSNVHoZFNtetJ0T7PTb3cFZ2+kcfdR2w3dRoev+sjj/r8tO/woPnP5p9zjt8t8x0Y0vlaBsVCzvd7TBwMHnHeekd6TlgmgDqfCEqDH3iw0Oe10neTHO1UUnza+bTl+zCqtZRD4u1y/l2DlZkYeEjdQ4pzSojhMe0SdKhOAiu2s4yym9EeOCYC+kSQr3jgv1/h22FOkdMeLpB6ITwmOVrTetnO7Qbb8hSO7B/RyRIO7nRXdxEOgvl6SPZG29Vt+/L1LJt8uGbdQbzVydnC3FqznzVYpMovRThP8IqkgmXFc9lZ/KJQAAAAAAAAAAAAAAAAAAAAAAAAAAAABY5x8NJf5GACgAAA==" | base64 --decode | gunzip | tar -xv
nginx -t
systemctl reload nginx</code></pre>
<p>Download this section: <a href="src/web.sh">https://aigarskadikis.github.io/src/web.sh</a><br />
Fancy syntax highlighter? Read same page on GitHub: <a href="https://github.com/aigarskadikis/aigarskadikis.github.io/blob/main/src/web.sh" target="_blank">https://github.com/aigarskadikis/aigarskadikis.github.io/blob/main/src/web.sh</a></p>
</div>
<input type="radio" name="tabs" id="delete"><label for="delete">delete.sql</label><div class="tab">
Discard all users which is using frontend<pre><code>DELETE FROM session;</code></pre>
Delete all events comming from specific trigger id. Only execute if trigger is not in problem state<pre><code>DELETE FROM events WHERE events.source=0 AND events.object=0 AND events.objectid=987654321;</code></pre>
Delete discovery, autoregistration and internal events<pre><code>DELETE FROM events WHERE source IN (1,2,3) LIMIT 1; DELETE FROM events WHERE source IN (1,2,3) LIMIT 10; DELETE FROM events WHERE source IN (1,2,3) LIMIT 100;</code></pre>
Delete child events which was closed by global correlation<pre><code>DELETE e FROM events e LEFT JOIN event_recovery ON (event_recovery.eventid=e.eventid) WHERE event_recovery.c_eventid IS NOT NULL AND e.clock < 1234;</code></pre>
<p>Download this section: <a href="src/delete.sql">https://aigarskadikis.github.io/src/delete.sql</a><br />
Fancy syntax highlighter? Read same page on GitHub: <a href="https://github.com/aigarskadikis/aigarskadikis.github.io/blob/main/src/delete.sql" target="_blank">https://github.com/aigarskadikis/aigarskadikis.github.io/blob/main/src/delete.sql</a></p>
</div>
<input type="radio" name="tabs" id="server"><label for="server">server.sql</label><div class="tab">
How many user groups has debug mode 1<pre><code>SELECT COUNT(*) FROM usrgrp WHERE debug_mode=1;</code></pre>
Active problems, including Zabbix internal problems (item unsupported, trigger unsupported). Works on Zabbix 4.0, 5.0, 6.0, 6,2<pre><code>SELECT COUNT(*),source,object,severity FROM problem GROUP BY 2,3,4 ORDER BY severity;</code></pre>
Hosts having problems with passive checks. Zabbix 4.0 till 5.2<pre><code>SELECT proxy.host AS proxy,hosts.host,hosts.error FROM hosts LEFT JOIN hosts proxy ON (hosts.proxy_hostid=proxy.hostid) WHERE LENGTH(hosts.error)>0;</code></pre>
Check Zabbix 6.0 native HA heartbeat. When was the last time the node reported back. Good way to ensure if DB replication is responsive<pre><code>SELECT * FROM ha_node;</code></pre>
Count of events. All version of Zabbix<pre><code>SELECT COUNT(*),source FROM events GROUP BY source;</code></pre>
Show items by proxy. Works from Zabbix 3.0 till 6.2<pre><code>SELECT COUNT(*),proxy.host AS proxy,items.type FROM items JOIN hosts ON (items.hostid=hosts.hostid) JOIN hosts proxy ON (hosts.proxy_hostid=proxy.hostid) WHERE hosts.status = 0 AND items.status = 0 AND proxy.status IN (5,6) GROUP BY 2,3 ORDER BY 2,3;</code></pre>
Devices and it's status. Works from Zabbix 3.0 till 5.2<pre><code>SELECT proxy.host AS proxy, hosts.host, interface.ip, interface.dns, interface.useip, CASE hosts.available WHEN 0 THEN 'unknown'  WHEN 1 THEN 'available' WHEN 2 THEN 'down' END AS "status", CASE interface.type WHEN 1 THEN 'ZBX' WHEN 2 THEN 'SNMP' WHEN 3 THEN 'IPMI' WHEN 4 THEN 'JMX' END AS "type", hosts.error FROM hosts JOIN interface ON interface.hostid=hosts.hostid LEFT JOIN hosts proxy ON hosts.proxy_hostid=proxy.hostid WHERE hosts.status=0 AND interface.main=1;</code></pre>
Items in use<pre><code>SELECT CASE items.type WHEN 0 THEN 'Zabbix agent' WHEN 2 THEN 'Zabbix trapper' WHEN 3 THEN 'Simple check' WHEN 5 THEN 'Zabbix internal' WHEN 7 THEN 'Zabbix agent (active) check' WHEN 8 THEN 'Aggregate' WHEN 9 THEN 'HTTP test (web monitoring scenario step)' WHEN 10 THEN 'External check' WHEN 11 THEN 'Database monitor' WHEN 12 THEN 'IPMI agent' WHEN 13 THEN 'SSH agent' WHEN 14 THEN 'TELNET agent' WHEN 15 THEN 'Calculated' WHEN 16 THEN 'JMX agent' WHEN 17 THEN 'SNMP trap' WHEN 18 THEN 'Dependent item' WHEN 19 THEN 'HTTP agent' WHEN 20 THEN 'SNMP agent' END as type,COUNT(*) FROM items JOIN hosts ON (hosts.hostid=items.hostid) WHERE hosts.status=0 AND items.status=0 GROUP BY items.type ORDER BY COUNT(*) DESC;</code></pre>
Exceptions in update interval. When a user install a custom update frequency in a host level and the frequency differs from template level. This query also detects difference between nested templates<pre><code>SELECT h1.host AS exceptionInstalled, i1.name, i1.key_, i1.delay, h2.host AS differesFromTemplate, i2.name, i2.key_, i2.delay FROM items i1 JOIN items i2 ON (i2.itemid=i1.templateid) JOIN hosts h1 ON (h1.hostid=i1.hostid) JOIN hosts h2 ON (h2.hostid=i2.hostid) WHERE i1.delay<>i2.delay;</code></pre>
All events closed by global correlation rule. Zabbix 4.0, 5.0, 6.0<pre><code>SELECT repercussion.clock, repercussion.name, rootCause.clock, rootCause.name FROM events repercussion JOIN event_recovery ON (event_recovery.eventid=repercussion.eventid) JOIN events rootCause ON (rootCause.eventid=event_recovery.c_eventid) WHERE event_recovery.c_eventid IS NOT NULL ORDER BY repercussion.clock ASC;</code></pre>
All active data collector items. Zabbix 3.0, 4.0, 5.0, 6.0<pre><code>SELECT hosts.host, items.name, items.type, items.key_, items.delay FROM items JOIN hosts ON (hosts.hostid=items.hostid) WHERE hosts.status=0 AND items.status=0 ORDER BY 1,2,3,4,5;</code></pre>
Determine which items report unsupported state:<pre><code>SELECT COUNT(items.key_), hosts.host, items.key_, item_rtdata.error FROM events JOIN items ON (items.itemid=events.objectid) JOIN hosts ON (hosts.hostid=items.hostid) JOIN item_rtdata ON (item_rtdata.itemid=items.itemid) WHERE source=3 AND object=4 AND items.status=0 AND items.flags IN (0,1,4) AND LENGTH(item_rtdata.error)>0 GROUP BY hosts.host,items.key_, item_rtdata.error ORDER BY COUNT(items.key_);</code></pre>
List all function names together with arguments<pre><code>SELECT functions.name, functions.parameter, COUNT(*) FROM functions JOIN items ON (items.itemid = functions.itemid) JOIN hosts ON (items.hostid = hosts.hostid) JOIN triggers ON (triggers.triggerid=functions.triggerid) WHERE hosts.status=0 AND items.status=0 AND triggers.status=0 GROUP BY 1,2 ORDER BY 1;</code></pre>
Owner of LLD dependent item. What is interval for owner. Zabbix 4.0 => 6.2<pre><code>SELECT master_itemid.key_,master_itemid.delay,COUNT(*) FROM items JOIN hosts ON (hosts.hostid=items.hostid) JOIN items master_itemid ON (master_itemid.itemid=items.master_itemid) WHERE items.flags=1 AND hosts.status=0 AND items.status=0 AND master_itemid.status=0 AND items.type=18 GROUP BY 1,2 ORDER BY 3 DESC;</code></pre>
Frequency of LLD rule for enabled hosts and enabled items discoveries for only monitored hosts. Zabbix 4.0 => 6.2<pre><code>SELECT type,delay,COUNT(*) FROM items JOIN hosts ON (hosts.hostid=items.hostid) WHERE items.flags=1 AND hosts.status=0 AND items.status=0 GROUP BY 1,2 ORDER BY 1,2;</code></pre>
Host inventory<pre><code>SELECT host_inventory.macaddress_a,GROUP_CONCAT(hosts.host) FROM host_inventory JOIN hosts ON (hosts.hostid=host_inventory.hostid) WHERE hosts.status=0 AND host_inventory.macaddress_a LIKE '%enterprises%' GROUP BY host_inventory.macaddress_a;</code></pre>
Remove metrics where there are no item definition anymore<pre><code>DELETE FROM trends WHERE itemid NOT IN (SELECT itemid FROM items); DELETE FROM trends_uint WHERE itemid NOT IN (SELECT itemid FROM items); DELETE FROM history_text WHERE itemid NOT IN (SELECT itemid FROM items); DELETE FROM history_str WHERE itemid NOT IN (SELECT itemid FROM items); DELETE FROM history_log WHERE itemid NOT IN (SELECT itemid FROM items); DELETE FROM history WHERE itemid NOT IN (SELECT itemid FROM items);</code></pre>
<p>Download this section: <a href="src/server.sql">https://aigarskadikis.github.io/src/server.sql</a><br />
Fancy syntax highlighter? Read same page on GitHub: <a href="https://github.com/aigarskadikis/aigarskadikis.github.io/blob/main/src/server.sql" target="_blank">https://github.com/aigarskadikis/aigarskadikis.github.io/blob/main/src/server.sql</a></p>
</div>
<input type="radio" name="tabs" id="users"><label for="users">users.sql</label><div class="tab"><p>Create MySQL users using wizard: <a href="./u/index.html">https://aigarskadikis.github.io/u</a></p>
Create an empty database with name 'zbx_db'. Zabbix 6.0 LTS<pre><code>CREATE DATABASE zbx_db CHARACTER SET utf8mb4 COLLATE utf8mb4_bin;</code></pre>
DB1. User for replication<pre><code>CREATE USER 'repl'@'192.168.88.101' IDENTIFIED WITH mysql_native_password BY 'PasswordForDBReplication'; GRANT REPLICATION SLAVE ON *.* TO 'repl'@'192.168.88.101';</code></pre>
DB2. User for replication<pre><code>CREATE USER 'repl'@'192.168.88.102' IDENTIFIED WITH mysql_native_password BY 'PasswordForDBReplication'; GRANT REPLICATION SLAVE ON *.* TO 'repl'@'192.168.88.102';</code></pre>
APP1. User for 'zabbix-server'<pre><code>CREATE USER 'zbx_srv'@'192.168.88.111' IDENTIFIED WITH mysql_native_password BY 'PasswordForApplicationServer';</code></pre>
APP2. User for 'zabbix-server'<pre><code>CREATE USER 'zbx_srv'@'192.168.88.112' IDENTIFIED WITH mysql_native_password BY 'PasswordForApplicationServer';</code></pre>
Bare minumum permissions for 'zabbix-server'<pre><code>CREATE ROLE 'zbx_srv_role'; GRANT SELECT, UPDATE, DELETE, INSERT, CREATE, DROP, ALTER, INDEX, REFERENCES ON zbx_db.* TO 'zbx_srv_role';</code></pre>
Allow to use Zabbix 6.2. Required for incremental configuration synchronisation<pre><code>SET GLOBAL log_bin_trust_function_creators = 1;</code></pre>
APP1. Assign role<pre><code>GRANT 'zbx_srv_role' TO 'zbx_srv'@'192.168.88.111'; SET DEFAULT ROLE 'zbx_srv_role' TO 'zbx_srv'@'192.168.88.111';</code></pre>
APP2. Assign role<pre><code>GRANT 'zbx_srv_role' TO 'zbx_srv'@'192.168.88.112'; SET DEFAULT ROLE 'zbx_srv_role' TO 'zbx_srv'@'192.168.88.112';</code></pre>
GUI1. User for 'nginx'<pre><code>CREATE USER 'zbx_web'@'192.168.88.121' IDENTIFIED WITH mysql_native_password BY 'PasswordForFrontendNode';</code></pre>
GUI2. User for 'nginx'<pre><code>CREATE USER 'zbx_web'@'192.168.88.122' IDENTIFIED WITH mysql_native_password BY 'PasswordForFrontendNode';</code></pre>
Install bare minimum permissions for frontend<pre><code>CREATE ROLE 'zbx_web_role'; GRANT SELECT, UPDATE, DELETE, INSERT ON zbx_db.* TO 'zbx_web_role';</code></pre>
GUI1. Assign role<pre><code>GRANT 'zbx_web_role' TO 'zbx_web'@'192.168.88.121'; SET DEFAULT ROLE 'zbx_web_role' TO 'zbx_web'@'192.168.88.121';</code></pre>
GUI2. Assign role<pre><code>GRANT 'zbx_web_role' TO 'zbx_web'@'192.168.88.122'; SET DEFAULT ROLE 'zbx_web_role' TO 'zbx_web'@'192.168.88.122';</code></pre>
User for DB partitioning script<pre><code>CREATE USER 'zbx_part'@'127.0.0.1' IDENTIFIED WITH mysql_native_password BY 'PasswordForDBPartitioning'; GRANT ALL PRIVILEGES ON *.* to 'zbx_part'@'127.0.0.1';</code></pre>
User to monitor the health of MySQL server via local Zabbix agent 2. Not suitable for RDS.<pre><code>CREATE USER 'zbx_monitor'@'127.0.0.1' IDENTIFIED WITH mysql_native_password BY 'PasswordForAgent2MySQLMonitoring'; GRANT REPLICATION CLIENT,PROCESS,SHOW DATABASES,SHOW VIEW ON *.* TO 'zbx_monitor'@'127.0.0.1';</code></pre>
APP1. User to monitor RDS database<pre><code>CREATE USER 'zbx_monitor'@'192.168.88.111' IDENTIFIED WITH mysql_native_password BY 'PasswordForAgent2MySQLMonitoring'; GRANT REPLICATION CLIENT,PROCESS,SHOW DATABASES,SHOW VIEW ON *.* TO 'zbx_monitor'@'192.168.88.111';</code></pre>
APP2. User to monitor RDS database<pre><code>CREATE USER 'zbx_monitor'@'192.168.88.112' IDENTIFIED WITH mysql_native_password BY 'PasswordForAgent2MySQLMonitoring'; GRANT REPLICATION CLIENT,PROCESS,SHOW DATABASES,SHOW VIEW ON *.* TO 'zbx_monitor'@'192.168.88.112';</code></pre>
Backup user for 'mysqldump'<pre><code>CREATE USER 'zbx_backup'@'127.0.0.1' IDENTIFIED WITH mysql_native_password BY 'PassfordForMySQLDUmp'; GRANT SELECT, LOCK TABLES, SHOW VIEW, RELOAD ON *.* TO 'zbx_backup'@'127.0.0.1';</code></pre>
Read only user for reporting<pre><code>CREATE USER 'zbx_read_only'@'127.0.0.1' IDENTIFIED WITH mysql_native_password BY 'PasswordForReadOnlyUser'; GRANT SELECT ON zbx_db.* TO 'zbx_backup'@'127.0.0.1';</code></pre>
User for grafana which runs in docker<pre><code>CREATE USER 'grafana'@'%' IDENTIFIED WITH mysql_native_password BY 'PasswordForReadOnlyGrafanaUser'; GRANT SELECT ON zbx_db.* TO 'grafana'@'%';</code></pre>
<p>Download this section: <a href="src/users.sql">https://aigarskadikis.github.io/src/users.sql</a><br />
Fancy syntax highlighter? Read same page on GitHub: <a href="https://github.com/aigarskadikis/aigarskadikis.github.io/blob/main/src/users.sql" target="_blank">https://github.com/aigarskadikis/aigarskadikis.github.io/blob/main/src/users.sql</a></p>
</div>
</div></body></html>
