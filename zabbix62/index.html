<html><head><style type='text/css'>
a{text-decoration:none;color:blue}a:hover{text-decoration:underline}ol li{list-style-type:none}p,li,ol{width:100%;padding:0 0 0 0;margin:0 0 0 0}ol{padding:0 0 1em}pre{width:100%},.tabs .tab,.tabs input[type=radio]:checked+label{background:#fff}.tabs,.tabs label,body{display:flex}.tabs .tab,.tabs input[type=radio]{display:none}#searchResultDlg,#searchResultDlgContent{overflow:auto;overscroll-behavior:contain}#closeIcon,.tabs input[type=radio]:checked+label+.tab{display:block}.tabs{flex-wrap:wrap;width:100%}.tabs label{order:1;justify-content:center;align-items:center;padding:.1rem .5rem;margin:0;cursor:pointer}.tabs .tab{order:9;flex-grow:1;width:100%;height:1000rem;padding:.4rem}body{background:#dcdcdc;min-height:100vh;box-sizing:border-box;font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen,Ubuntu,Fira Sans,Droid Sans,Helvetica Neue,sans-serif;font-weight:300;line-height:1.5;font-size:100%}pre{padding:.2em;margin:0 0 1em;background-color:#FFF7F0;border-radius:3px;border:1px solid #CCCCCC}#searchInputArea{display:flex;position:absolute;right:50px;top:5px}#searchInput{margin-left:20px;border:0}#searchInput:focus{outline:0}#searchResultDlg{display:none;flex-direction:column;position:fixed;top:50px;left:100px;right:100px;bottom:50px;padding:10px;background-color:#dcdcdc}#searchResultDlgContent{display:grid;flex-direction:column;height:100%}#closeIcon{color:#778899;font-size:55px;position:fixed;top:20px;right:50px;cursor:pointer}.resultBlock{width:100%;border-bottom:1px solid #000}.resultBlock .tabName{font-size:1.2em;font-weight:700}.tog{width:100%}
</style></head><body onLoad='initDataArray()'><div class='tabs'><div class='tog'><label for='toggler'>Use single line mode <input id='singleLineToggle' name='toggler' type='checkbox' /></label><script type='text/javascript'>if(/MSIE \d|Trident.*rv:/.test(navigator.userAgent)){document.write('<script src=../singleLine.togglerIE.js><\/script>')}else{document.write('<script src=../singleLine.toggler.js><\/script>')}</script><script>var el=document.getElementById('singleLineToggle');el.addEventListener('change',function(ev){toSingleLine(ev.target.checked)})</script></div>
<input type="radio" name="tabs" id="62" checked="checked"><label for="62">62.sql</label><div class="tab"><ol><li><a href="#ca58b3c2f168159fe72689b1878a5794">Active problems, including Zabbix internal problems (item unsupported, trigger unsupported)</a></li><li><a href="#27d4e096992b4449576e8e526ebfac0b">Non-working external scripts</a></li><li><a href="#f16cb58e4b510dd3b89f08ceccb54789">Check native HA heartbeat</a></li><li><a href="#3f8c12fb0e6f189a488d2d05c78f485e">Show items by proxy</a></li><li><a href="#5fdf0d3b15ae4ca17ba8cbd05ea30a52">Items in use</a></li><li><a href="#515bb880e1666408ef79e9655e448ed5">Owner of LLD dependent item. What is interval for owner</a></li><li><a href="#e09f1718e8f0d561ca652e2ccf21101c">Frequency of LLD rule for enabled hosts and enabled items discoveries for only monitored hosts</a></li><li><a href="#5ea279232fa8c6cb29820f8b4c97635c">Host behind proxy 'z62prx' where interface is not healthy. Host is down</a></li><li><a href="#7057ba8e9206fdcdc7a8c1272c72b335">Host/interface errors per all hosts behind proxy</a></li><li><a href="#69964261e9a48cd7e569e256bf7e7ff3">For items which are currently disabled, clean the error message in database. This will help to locate what really is not working and why</a></li><li><a href="#f48c29ddfb46d241bfca2ec8062fce56">For items which are currently disabled, reset the state as supported. This will help to locate what really is not working and why. Item will remain disabled</a></li><li><a href="#c27d849693910935510c58a688d95c18">Print error message for enabled hosts and enabled data collector items</a></li></ol>
<p id="ca58b3c2f168159fe72689b1878a5794">Active problems, including Zabbix internal problems (item unsupported, trigger unsupported)</p><pre><code>SELECT COUNT(*), source, object, severity FROM problem GROUP BY 2,3,4 ORDER BY severity;</code></pre>
<p id="27d4e096992b4449576e8e526ebfac0b">Non-working external scripts</p><pre><code>SELECT
hosts.host,
items.key_,
item_rtdata.error
FROM items
JOIN hosts ON (hosts.hostid=items.hostid)
JOIN item_rtdata ON (items.itemid=item_rtdata.itemid)
WHERE hosts.status=0
AND items.status=0
AND items.type=10
AND LENGTH(item_rtdata.error) > 0;</code></pre>
<p id="f16cb58e4b510dd3b89f08ceccb54789">Check native HA heartbeat</p><pre><code>SELECT * FROM ha_node;</code></pre>
<p id="3f8c12fb0e6f189a488d2d05c78f485e">Show items by proxy</p><pre><code>SELECT
COUNT(*) AS count,
proxy.host AS proxy,
items.type
FROM items
JOIN hosts ON (items.hostid=hosts.hostid)
JOIN hosts proxy ON (hosts.proxy_hostid=proxy.hostid)
WHERE hosts.status=0
AND items.status=0
AND proxy.status IN (5,6)
GROUP BY 2,3
ORDER BY 2,3;</code></pre>
<p id="5fdf0d3b15ae4ca17ba8cbd05ea30a52">Items in use</p><pre><code>SELECT
CASE items.type
WHEN 0 THEN 'Zabbix agent'
WHEN 1 THEN 'SNMPv1 agent'
WHEN 2 THEN 'Zabbix trapper'
WHEN 3 THEN 'Simple check'
WHEN 4 THEN 'SNMPv2 agent'
WHEN 5 THEN 'Zabbix internal'
WHEN 6 THEN 'SNMPv3 agent'
WHEN 7 THEN 'Zabbix agent (active) check'
WHEN 8 THEN 'Aggregate'
WHEN 9 THEN 'HTTP test (web monitoring scenario step)'
WHEN 10 THEN 'External check'
WHEN 11 THEN 'Database monitor'
WHEN 12 THEN 'IPMI agent'
WHEN 13 THEN 'SSH agent'
WHEN 14 THEN 'TELNET agent'
WHEN 15 THEN 'Calculated'
WHEN 16 THEN 'JMX agent'
WHEN 17 THEN 'SNMP trap'
WHEN 18 THEN 'Dependent item'
WHEN 19 THEN 'HTTP agent'
WHEN 20 THEN 'SNMP agent'
WHEN 21 THEN 'Script item'
END AS type,
COUNT(*)
FROM items
JOIN hosts ON (hosts.hostid=items.hostid)
WHERE hosts.status=0
AND items.status=0
GROUP BY items.type
ORDER BY COUNT(*) DESC;</code></pre>
<p id="515bb880e1666408ef79e9655e448ed5">Owner of LLD dependent item. What is interval for owner</p><pre><code>SELECT master_itemid.key_, master_itemid.delay, COUNT(*)
FROM items
JOIN hosts ON (hosts.hostid=items.hostid)
JOIN items master_itemid ON (master_itemid.itemid=items.master_itemid)
WHERE items.flags=1
AND hosts.status=0
AND items.status=0
AND master_itemid.status=0
AND items.type=18
GROUP BY 1,2 ORDER BY 3 DESC;</code></pre>
<p id="e09f1718e8f0d561ca652e2ccf21101c">Frequency of LLD rule for enabled hosts and enabled items discoveries for only monitored hosts</p><pre><code>SELECT type,delay,COUNT(*) FROM items
JOIN hosts ON (hosts.hostid=items.hostid)
WHERE items.flags=1 AND hosts.status=0 AND items.status=0
GROUP BY 1,2 ORDER BY 1,2;</code></pre>
<p id="5ea279232fa8c6cb29820f8b4c97635c">Host behind proxy 'z62prx' where interface is not healthy. Host is down</p><pre><code>SELECT
hosts.host,
interface.error
FROM interface
JOIN hosts ON (hosts.hostid=interface.hostid)
LEFT JOIN hosts proxy ON (hosts.proxy_hostid=proxy.hostid)
WHERE interface.available=2
AND hosts.status=0
AND proxy.host='z62prx';</code></pre>
<p id="7057ba8e9206fdcdc7a8c1272c72b335">Host/interface errors per all hosts behind proxy</p><pre><code>SELECT
proxy.host,
hosts.host,
interface.error
FROM interface
JOIN hosts ON (hosts.hostid=interface.hostid)
LEFT JOIN hosts proxy ON (hosts.proxy_hostid=proxy.hostid)
WHERE interface.available=2
AND proxy.host IS NOT NULL
ORDER BY 1,2,3;</code></pre>
<p id="69964261e9a48cd7e569e256bf7e7ff3">For items which are currently disabled, clean the error message in database. This will help to locate what really is not working and why</p><pre><code>UPDATE item_rtdata
SET error=''
WHERE state=1
AND itemid IN (
SELECT items.itemid
FROM items, hosts
WHERE hosts.hostid=items.hostid
AND hosts.status=0
AND items.status=1
);</code></pre>
<p id="f48c29ddfb46d241bfca2ec8062fce56">For items which are currently disabled, reset the state as supported. This will help to locate what really is not working and why. Item will remain disabled</p><pre><code>UPDATE item_rtdata
SET state=0
WHERE state=1
AND itemid IN (
SELECT items.itemid
FROM items, hosts
WHERE hosts.hostid=items.hostid
AND hosts.status=0
AND items.status=1
);</code></pre>
<p id="c27d849693910935510c58a688d95c18">Print error message for enabled hosts and enabled data collector items</p><pre><code>SELECT
hosts.host,
items.name,
item_rtdata.error AS error
FROM item_rtdata, items, hosts
WHERE item_rtdata.state=1
AND hosts.status=0
AND items.status=0
AND item_rtdata.itemid=items.itemid
AND hosts.hostid=items.hostid;</code></pre>
<p>Download this section: <a href="src/62.sql">https://aigarskadikis.github.io/src/62.sql</a><br />
Fancy syntax highlighter? Read same page on GitHub: <a href="https://github.com/aigarskadikis/aigarskadikis.github.io/blob/main/src/62.sql" target="_blank">https://github.com/aigarskadikis/aigarskadikis.github.io/blob/main/src/62.sql</a></p>
</div>
</div></body></html>
